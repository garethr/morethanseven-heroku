
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Morethanseven</title>
  <meta name="author" content="Gareth Rushgrove">

  
  <meta name="description" content="I&#8217;ve written about Vagrant previously and the more I use it the more it impresses me and the more it changes how I work. For those that haven&# &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.morethanseven.net/page/5">
  <link href="/favicon.ico" rel="icon">
  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/articles.atom" rel="alternate" title="Morethanseven" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<meta content="etkmKMftqAyYJM6-DP_TTKJjV0EHM5vbVcaOloSo8Z8" name="google-site-verification">
<link href="http://www.myopenid.com/server" rel="openid.server">
<link href="http://garethr.myopenid.com/" rel="openid.delegate">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-435455-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header>
<hgroup>
<h1><a href="/">Morethanseven</a></h1>
<p>The blog of Gareth Rushgrove</p>

<div id='carbonads-container'>
  <div class='carbonad'>
    <div id='carbon'></div>
    <script type='text/javascript'>
      //<![CDATA[
        var z = document.createElement("script");
        z.type = "text/javascript";
        z.async = true;
        z.src = "http://engine.carbonads.com/z/12119/carbon_2_1_0_HORIZ";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(z, s);
      //]]>
    </script>
  </div>
</div>

</hgroup>
</header>


  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/10/My-default-recipes-for-vagrant-virtual-machines/">My Default Recipes for Vagrant Virtual Machines</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-10T00:00:00+00:00" pubdate data-updated="true">Jan 10<span>th</span>, 2011</time>
        
         | <a href="/2011/01/10/My-default-recipes-for-vagrant-virtual-machines/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve written about <a href="http://morethanseven.net/2010/11/04/Why-you-should-be-using-virtualisation.html">Vagrant previously</a> and the more I use it the more it impresses me and the more it changes how I work. For those that haven&#8217;t yet used <a href="http://vagrantup.com">vagrant</a> the brief summary is, it&#8217;s a way of managing, creating and destroying headless virtualbox virtual machines. So when I&#8217;m sat at my computer and I want a new 32 bit virtual machine based on Maverick I just type.</p>
<pre>vagrant init maverick32
vagrant up</pre>
<p>It has some other magic tricks as well, like automatically setting up <span class="caps">NFS</span> shares between the host and guest and allowing you to specify ports to forward in the configuration file. You access the machine via ssh, either using the handy <em>vagrant ssh</em> command or by using <em>vagrant ssh-config</em> to dump the relevant configuration to place in ~/.ssh/config.</p>
<p>I&#8217;ve been using virtualisation for a few years, initially purely for testing and experimentation, and then eventually for all my development. I&#8217;d have a few VMware images, I&#8217;d use snapshots and occasionally rollback, but I very rarely created new virtual machines. It was quite a manual process. With vagrant that&#8217;s changing. Everytime I start investigating a new tool or new technology or work on a pet project I create a new virtual machine. That way I know exactly what I&#8217;m dealing with, and with vagrant the cost of doing that is the 30s waiting for the new machine to boot.</p>
<p>Or rather it would be if I didn&#8217;t then have to install and configure the same few things on every machine. Pretty much whatever I might be doing I found myself installing the same things, namely zsh, vim, git and utils like ack, wget, curl and lynx. This is exactly what the provisioning support in vagrant is for, so I set out to use chef to do this for me.</p>
<p>I decided to use a remote tar file for the recipes. I&#8217;m not really bothered about managing a chef server just for my personal virtual machines, but I did want to have a canonical source of the cookbooks that wasn&#8217;t local to just one of my machines. Plus this means anyone else who shares my opinions about what you want on a new virtual machine can use them too.</p>
<p>My Vagrantfile now looks like this:</p>
<pre>Vagrant::Config.run do |config|
  config.vm.box = "maverick32"
  config.vm.provisioner = :chef_solo
  config.chef.recipe_url = "http://cloud.github.com/downloads/garethr/chef-repo/cookbooks.tar.gz"
  config.chef.add_recipe "garethr"
  config.chef.cookbooks_path = [:vm, "cookbooks"]
  config.chef.json.merge!({ :garethr =&gt; {
      :ohmyzsh =&gt; "https://github.com/garethr/oh-my-zsh.git",
      :dotvim =&gt; "https://github.com/garethr/dotvim.git"
    }})
end</pre>
<p>You can see the cookbook on GitHub at <a href="https://github.com/garethr/chef-repo/">github.com/garethr/chef-repo</a>. By default it uses the <a href="https://github.com/robbyrussell/oh-my-zsh.git">official oh-my-zsh repo</a> and the <a href="https://github.com/jtimberman/dotvim.git">vim configuration from jtimberman</a>. My own versions are very minor personal preference modifications of those. The Vagrantfile example above shows how you can override the defaults and use your own configs instead if you choose.</p>
<p>One question I was asked about this approach was why I didn&#8217;t just create a basebox with all these things installed by default, this would reduce the time taken on first boot as software wouldn&#8217;t have to be installed each time. However it would also mean maintaining the basebox&#8217;s myself, and as I use different Linux distributions or versions this would be a headache. While doing this and working with vagrant I&#8217;ve been thinking about the ecosystem around the tool and I&#8217;m planning on writing my thoughts on that subject over the next week or so.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/01/Solr-libraries-and-good-api-design/">Solr Libraries and Good API Design</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-01T00:00:00+00:00" pubdate data-updated="true">Jan 1<span>st</span>, 2011</time>
        
         | <a href="/2011/01/01/Solr-libraries-and-good-api-design/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m a huge <a href="http://wiki.apache.org/solr/">Solr</a> fan. Once you understand what it does (it&#8217;s a search engine, which means more than you think) and how it works you spot lots of thorny problems that map to it&#8217;s features really well. In my experience it&#8217;s also very fast and very stable once installed and setup. Oh, and the community support is great as well.</p>
<p>When I talk to some folks about Solr all they can think about is full text search. The main reason for this I think is a number of poor libraries. I&#8217;ve come across lots of Python or Ruby libraries that simply say you don&#8217;t have to know anything about Solr, just install this code and you get full text search! This works in the same way as using the default Mysql or Apache configs works, nowhere near as well as if you get your hands dirty even a little. Some of the ruby gems even ship the Solr jar file in the gem. Now you don&#8217;t even need to know Solr exists. You take a generic configuration and run it using a rake task behind which is some unknown Java application server. Good luck debugging that when it goes wrong, that&#8217;s one hell of a leeky abstraction.</p>
<p>In better news I&#8217;ve now found two excellent Solr libraries, one&#8217;s that start with the assumption that you know what you&#8217;re doing or happy to learn about the tools you&#8217;re using. All you really want from a library is a good <span class="caps">API</span> that maps to how you write in that language.</p>
<h2>Delsolr (Ruby)</h2>
<p>The <a href="http://delsolr.rubyforge.org/">delsolr</a> <span class="caps">API</span> is beautiful. It seemlessly merges the worlds of Ruby and Solr in a way that&#8217;s easy to write and easy to guess. It&#8217;s also clever, the design accepts that new features might be added to Solr before the library is updated or that the library might not support every usecase or option. In these cases you can still pass information through to Solr directly.</p>
<p>Solr&#8217;s interface is based around URLs, so any library is really just giving you an interface to creating those URLs.Writing the following in Ruby:</p>
<pre>rsp = solr.query('standard',
               :query =&gt; '*:*',
               :filters =&gt; {:status =&gt; 'Active'},
               :facets =&gt; [{:field =&gt; 'project'}]
    ])</pre>
<p>Results in the following <span class="caps">URL</span>:</p>
<pre>/select?q=*:*&amp;wt=ruby&amp;facet=true&amp;facet.field=status&amp;facet.field=name&amp;fq=status:Active</pre>
<p>If you already know Solr and how to construct URLs for searches by hand you&#8217;ll immediately get the Ruby code. You can probably even guess how to pass other params like sort or order.</p>
<p>Another nice touch is that you can use either hashes or Lucene search syntax for each attribute. So:</p>
<pre>:filters =&gt; {:status =&gt; 'Active'}</pre>
<p>Is the same as:</p>
<pre>:filters =&gt; 'status:Active'</pre>
<h2>Sunburnt (Python)</h2>
<p><a href="http://blog.timetric.com/2010/02/08/sunburnt-a-python-solr-interface">Sunburnt</a> is a python Solr interface from the nice folks at <a href="http://timetric.com">Timetric</a>. I&#8217;ve not had chance to use this library in anger as it was released after I&#8217;d dont quite a bit of python-solr work in an old job but I&#8217;d definately use it now. The <span class="caps">API</span> looks like:</p>
<pre>rsp = solr.query('*:*').filter(status='Active').facet_by('project').execute()</pre>
<p>It&#8217;s based around chaining so again you can probably guess how to make further queries from even this simple example.</p>
<p>Both Sunburnt and Delsolr also support adding documents to the index.</p>
<h2>Uses</h2>
<p>Once you understand facets and the usefulness of filter queries you see lots of places where Solr is useful apart from text search. Lots of ecommerce operations use facetted search interfaces, I&#8217;m sure everyone has spent time clicking through nested heirachies and watching the numbers (showing the number of products) next to the links decrease? You can built these interfaces using <span class="caps">SQL</span> but it&#8217;s incredibly expensive and gets out of hand quickly. Caching only helps a bit due to the number of permutations in all but the smallest stores or simplest products. It&#8217;s a similar problem with tagging, it&#8217;s pretty easy to kill your database</p>
<p>But it&#8217;s not just things that have the word search in that you can map Solr to. Two good examples are Timetric (from whom the Sunburnt library comes from) and the <a href="http://www.guardian.co.uk/open-platform/blog/what-is-powering-the-content-api">Guardian Content <span class="caps">API</span></a>. Both of these present lots of read data straight from Solr with great success and less database killing performance issues. Solr can really be seen as a simple place to denormalise your data, one advantage being that it keeps your database schema clean.</p>
<h2>Learning More</h2>
<p>Solr could do with better documentation for beginners. The wiki is an excellent reference once you know how to write schema and configuration files but I think the getting started section sacrifices introducing configuration in favour of getting people searching quicker. The example schema and solrconfig files that ship with Solr are also amazingly useful references (officially the best commented <span class="caps">XML</span> I&#8217;ve ever seen) but also intimidating to beginners. The Drupal community appear to be writing some good docs that fill this gap though, here&#8217;s a few links that I&#8217;d recommend:</p>
<ul>
	<li><a href="http://www.drupalconnect.com/blog/steve/configuring-apache-solr-multi-core-drupal-and-tomcat-ubuntu-910">Step by step guide including Tomcat</a></li>
	<li><a href="http://synapticloop.com/tomes/solr/solr-tutorial/">Fantastic multi-part tutorial</a></li>
</ul></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/12/29/Heroku-for.../">Heroku For&#8230;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-29T00:00:00+00:00" pubdate data-updated="true">Dec 29<span>th</span>, 2010</time>
        
         | <a href="/2010/12/29/Heroku-for.../#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>With the success of <a href="http://heroku.com">Heroku</a>, both in terms of the recent sale and the fact it&#8217;s awesome, it was always just a matter of time before other languages and frameworks got into the platform as a service game. Here&#8217;s all the one&#8217;s I know about so far, many of them in or entering beta testing at the moment. Any others I&#8217;m missing?</p>
<p><strong>Update</strong> Thanks for all the comments on here and on <a href="http://news.ycombinator.com/item?id=2050203">Hacker News</a>, I&#8217;ve updated this list with all the suggestions.</p>
<h2>Ruby</h2>
<ul>
	<li><a href="http://www.duostack.com/">Duostack</a></li>
</ul>
<h2>Python</h2>
<ul>
	<li><a href="http://www.ep.io/">ep.io</a></li>
	<li><a href="http://DjangoZoom.com/">Django Zoom</a></li>
	<li><a href="https://www.djangy.com/">Djangy</a></li>
	<li><a href="http://appengine.google.com/">Google Appengine</a></li>
	<li><a href="http://stable.io/">Stable</a></li>
</ul>
<h2><span class="caps">PHP</span></h2>
<ul>
	<li><a href="http://phpfog.com/">PHPFog</a></li>
	<li><a href="http://cloudcontrol.com">CloudControl</a></li>
</ul>
<h2>.<span class="caps">NET</span></h2>
<ul>
	<li><a href="http://appharbor.com/">AppHarbor</a></li>
	<li><a href="http://biaslogic.com/">biasLogic</a></li>
	<li><a href="http://moncai.com/">Moncai</a></li>
	<li><a href="http://microsoft.com/azure">Microsoft Azure</a></li>
</ul>
<h2>Java (<span class="caps">JVM</span>)</h2>
<ul>
	<li><a href="http://www.cloudbees.com">CloudBees</a> via the purchase of <a href="http://stax.net/">Stax</a></li>
	<li><a href="http://appengine.google.com/">Google Appengine</a></li>
	<li><a href="http://www.playapps.net/">Playapps</a> (Play framework only)</li>
</ul>
<h2>Node.js</h2>
<ul>
	<li><a href="http://www.nodejscloud.com/">NodeJSCloud</a></li>
	<li><a href="https://no.de/">Joyent SmartMachine</a></li>
	<li><a href="http://www.duostack.com/">Duostack</a></li>
	<li><a href="http://nodejitsu.com/">Nodejitsu</a></li>
</ul>
<h2>RingoJS</h2>
<ul>
	<li><a href="http://www.erbix.com/">Erbix</a></li>
</ul>
<h2>Multi Platform</h2>
<ul>
	<li><a href="http://kodingen.com/">Kodingen</a></li>
	<li><a href="http://dotcloud.com">DotCloud</a></li>
</ul></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/12/24/A-vagrant-ecosystem/">A Vagrant Ecosystem</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-24T00:00:00+00:00" pubdate data-updated="true">Dec 24<span>th</span>, 2010</time>
        
         | <a href="/2010/12/24/A-vagrant-ecosystem/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As mentioned loudly and repeatedly on here and on Twitter I love <a href="http://vagrantup.com">vagrant</a>. While writing a chef cookbook to bootstrap my virtual machines I started thinking about how things around vagrant could help it be more useful. These might be things I&#8217;m going to do, or ideally get involved with others to do. If anyone has any other ideas, or suggestions please leave comments, I definately think this is the time for discussion.</p>
<h2>Baseboxes</h2>
<p>I don&#8217;t really want to have to maintain baseboxes but I want access to lots of them. I&#8217;m sure some people will want a <em>Ruby on Rails in a box</em> but all I really care about is having access to recent 32 and 63 bit vanilla linux distributions. I want a good source for trusted baseboxes. At the moment the approach is to look on the wiki, then look on the mailing list and then search the web, then create your own (even using <a href="https://github.com/jedi4ever/veewee">VeeWee</a> it&#8217;s still a little fiddly). I&#8217;ve managed to find good lucid, maverick and debian boxes, but have had problems with centos and a few others. Part of this is the rate of change recenty of both vagrant and now VirtualBox (both good things), part of it is the lack of reviews and shared experiences around baseboxes.</p>
<p>What I&#8217;d love to see is a single place where anyone can post a link to a basebox and vagrant users can come along and assign metadata about whether it worked and on what hardware, vagrant version, virtual box version, etc. It could even act as a tracker, counting downloads of boxes to gauge popularity.</p>
<h2>Templated Vagrantfiles</h2>
<p>As mentioned previously I have a chef cookbook I use to bootstrap all my new virtual machines. My process is therefore: <em>vagrant init</em>, make some manual changes to the Vagrantfile (or copy it from elsewhere), <em>vagrant up</em>. I&#8217;m lazy and want a nicer way to reuse Vagrantfiles or to script their creation.</p>
<p>I started out thinking that the ability to point the init command at a template and to provide context on the command line might be a good idea. Now I&#8217;m wondering whether we just need a command line application which allows for writing or modifying the Vagrantfile? Something like:</p>
<pre>vagrant config vm.provisioner=:chef_solo
vagrant config chef.recipe_url=http://cloud.github.com/downloads/garethr/chef-repo/cookbooks.tar.gz</pre>
<h2>Hosted cookbooks</h2>
<p>I dissed the idea of a <em>Ruby on Rails in a box</em> basebox above but I still want to be able to let people more easily share custom configuration for specialist applications. But what I&#8217;d prefer would be people sharing packaged cookbooks, a bit like I&#8217;ve done for my default virtual machine setup. Again the beauty of this is it&#8217;s pretty much just sharing a <span class="caps">URL</span> to a tar.gz file. This makes more sense to me at least than random people connecting to my chef server (I shouldn&#8217;t know about their machines) and lowers the barrier to entry for those not interested in hosting their own chef server or using the opscode platform for local virtual machines.</p>
<p>I&#8217;m also not talking here about just sharing individual cookbooks like <a href="http://cookbooks.opscode.com/">cookbooks.opscode.com</a>, but rather a packaged collection of individual recipes designed for a specific purpose. A fully working solr instance, a django application server using apache/mod_wsgi, etc.</p>
<p>Many of the points about baseboxes above would work here too I think. Having a good community resource which points to lots of cookbook tar files. Allowing people to feed back about what works for them. I&#8217;ve mainly taked about Chef here as that&#8217;s what vagrant initially shipped with, with the puppet provisioner now ready to go with would stand for puppet manifests too.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/12/20/Smoke-testing-with-cucumber-on-sysadvent/">Smoke Testing With Cucumber on Sysadvent</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-20T00:00:00+00:00" pubdate data-updated="true">Dec 20<span>th</span>, 2010</time>
        
         | <a href="/2010/12/20/Smoke-testing-with-cucumber-on-sysadvent/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I wrote a quick article last week for the excellent <a href="http://sysadvent.blogspot.com">sysadvent</a> advent calendar, <a href="http://sysadvent.blogspot.com/2010/12/day-17-smoke-testing-deployments-using.html">Smoke Testing Deployments with Cucumber</a> talks a bit more about using a few of my favourite tools to check whether a deployment just broke anything important.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/11/28/Sinatra-on-glassfish-example/">Sinatra on Glassfish Example</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-28T00:00:00+00:00" pubdate data-updated="true">Nov 28<span>th</span>, 2010</time>
        
         | <a href="/2010/11/28/Sinatra-on-glassfish-example/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I magically turned into a Java developer last week for a bit when I had to do some integration with a <span class="caps">SOAP</span> based <span class="caps">API</span> that really really wanted me to write Java on client as well. That led me down the route of having a good look at Jruby (which I&#8217;ve used before, mainly for testing using celerity) and in particular how easy it was to use native Java classes in Jruby (very, very easy as it turns out).</p>
<p>All that meant I&#8217;ll probably end up writing a nice Jruby application in the not too distant future, and not knowing too much about running such a thing in a production environment I thought I&#8217;d take a quick look. I went with Glassfish as the application server for no other reason that it took my fancy. I&#8217;d definately be interested in hearing about any positive or negative experiences people may have with it or other similar servers. My quick look turned into running a tiny Sinatra application.</p>
<p>First install the required gems for our little experiment. You&#8217;ll obviously need jruby which is sort of the point, I&#8217;d recommend using <span class="caps">RVM</span> for that.</p>
<pre><code>gem install sinatra warbler</pre><p></code></p>
<p>Now create a sinatra app. OK, it could be any Ruby rack based application but I like Sinatra. First we need a rackup file.</p>
<pre><code># config.ru
require 'init'

set :run, false
set :environment, :production

run Sinatra::Application</pre><p></code></p>
<p>Now for our application itself.</p>
<pre><code># init.rb
require 'rubygems'
require 'sinatra'
get '/' do
  "Hello World!"
end</pre><p></code></p>
<p>Warble is the gem we&#8217;re going to use to create a <span class="caps">WAR</span> file, which is basically an all in one bundle of our application and it&#8217;s dependencies which we can deploy to a java application server.</p>
<pre><code># config/warble.rb
Warbler::Config.new do |config|
  config.dirs = %w(config)
  config.includes = FileList["init.rb"]
  config.gems += ["sinatra"]
  config.gems -= ["rails"]
  config.gem_dependencies = true
end</pre><p></code></p>
<p>Now we&#8217;re ready to generate our <span class="caps">WAR</span> file.</p>
<pre><code>warble</pre><p></code></p>
<p>This should create a file called sample.war or similar. Then just deploy that to your application server and away you go. I got this working very easily with Glassfish which seemed to be the recommended tool for such things. Installing Glassfish was time consuming but <a href="http://www.nabisoft.com/tutorials/glassfish/installing-glassfish-301-on-ubuntu">well documented here</a>. Uploading to Glassfish was done via the web interface for the moment. I just selected a Ruby project from the deployment drop down and uploaded the war file.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/11/21/Devops-weekly/">Devops Weekly</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-21T00:00:00+00:00" pubdate data-updated="true">Nov 21<span>st</span>, 2010</time>
        
         | <a href="/2010/11/21/Devops-weekly/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve really been enjoying <a href="http://rubyweekly.com">Ruby Weekly</a> recently, it&#8217;s an email newsletter by <a href="http://peterc.org/">Peter Cooper</a> which brings the latest Ruby related news and articles to your inbox.</p>
<p>I have to admit to being sceptical at first about the format, I think I unsubscribed from most email newsletters many years ago, moving my reading to <span class="caps">RSS</span> and then Twitter. But I&#8217;ve actually found a regularly appearing email a great way to catch up with the goings on. A think the reasons for that change of heart are:</p>
<ul>
	<li>Their is simply more being written now that even a few years ago, and I&#8217;m interested in more topics.</li>
	<li>For a short time Hacker News solved this problem for me, but now it&#8217;s too high volume for me to subscribe and read everything.</li>
	<li>I now manage my email inbox pretty well, I&#8217;m not always at inbox zero but I can&#8217;t remember the last time it was over 20.</li>
	<li><span class="caps">RSS</span> is great, but it&#8217;s always a limited view unless you follow 1000s of feeds.</li>
	<li>Twitter is great but unless you read every tweet you&#8217;ll miss some important bit of new.s</li>
</ul>
<p>I think Ruby Weekly works because it&#8217;s collated by someone with taste. Peter spends a bit of time putting together a small number of high quality links so I don&#8217;t have to. With <a href="http://devopsweekly.com">Devops Weekly</a> I&#8217;m hoping to do the same for a different niche.</p>
<p><img src="http://image-host.appspot.com/i/img?id=agppbWFnZS1ob3N0cg0LEgVJbWFnZRjxqwEM"/></p>
<p>So head over to <a href="http://devopsweekly.com">devopsweekly.com</a> to sign up. I&#8217;m not 100% sure yet when the first issue will go out but expect it in the next few weeks, and after that I&#8217;ll try and get one issue out each week. Any ideas are more than welcome, as are any news or articles that you think should go in.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/11/07/Books-for-people-interested-in-devops/">Books for People Interested in Devops</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-07T00:00:00+00:00" pubdate data-updated="true">Nov 7<span>th</span>, 2010</time>
        
         | <a href="/2010/11/07/Books-for-people-interested-in-devops/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Before starting with FreeAgent I decided I should spend a bit more time with Ruby and set about building something I&#8217;d been thinking about for a while. I&#8217;ve just launched the first one of my related pet projects so thought I better link to it from here.</p>
<p><a href="http://devopsbooks.com"><img src="http://image-host.appspot.com/i/img?id=agppbWFnZS1ob3N0cg0LEgVJbWFnZRihnAEM"/></a></p>
<p><a href="http://devopsbooks.com">Devops Books</a> is exactly what it sounds like; a list of books that people interested in the whole devops concept should read. It&#8217;s not a complete list just yet and I&#8217;ll try and keep it up to date as new interesting books get released. Any suggestions to add to the list most welcome.</p>
<p>It gave me a proper excuse to use <a href="http://heroku.com">Heroku</a> which has been very pleasant. Under the hood it&#8217;s a very simple sinatra application using the Mustache template language. The majority of the code is a build script that pulls down information from the Amazon <span class="caps">API</span> and mixes it with my own content. It then creates a <span class="caps">JSON</span> document that is used as the basis for generating the pages. I love static generators and hand rolling your own for a particular domain is often worthwhile. It means I have the json already lying around if I want to make a <span class="caps">JSONP</span> style badge for instance.</p>
<p>I plan on using the code as a bit of learning tool. Try out some different testing approaches, maybe add in <span class="caps">GEOIP</span> detection, make some of the commands I&#8217;m running into Rake tasks, that sort of thing. Given how easy it will be to throw up little sites like this using the generator I have a few other similar things in mind too.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/11/04/Why-you-should-be-using-virtualisation/">Why You Should Be Using Virtualisation</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-04T00:00:00+00:00" pubdate data-updated="true">Nov 4<span>th</span>, 2010</time>
        
         | <a href="/2010/11/04/Why-you-should-be-using-virtualisation/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>My main development machine for a while has been an apple laptop. From looking around at conferences, offices and usergroups I know I&#8217;m not alone. But I don&#8217;t really <em>run</em> code on my mac very often, certainly not for work. I might edit the code on my mac but I execute it running in a virtualised Linux environment matching (as close as possible) the production environment it&#8217;s going to end up in. This blog post is an attempt to explain why this is a good idea to the majority of people who develop on a mac (or a windows machine) and deploy to something else. This isn&#8217;t language specific either. You might be working on small <span class="caps">PHP</span> web sites or huge Python applications, you&#8217;ll still one day run into the same issues.</p>
<h2>Why is virtualisation a good idea?</h2>
<p>Bugs happen, but catching them early, way before they even hit your shared source code repository makes them much less of an issue. Catching bugs only after a live release, when they affect customers and cost someone money is bad. And if your release is a long period of time after the work was done then fixing them is harder to boot. These are just some of the reasons we&#8217;re all fond of unit testing and continuous integration.</p>
<p>But if you&#8217;re running those tests against code executing on different hardware, on a different operating system, with different low level libraries or a different web server version or a different database server then you are not going to catch all the problems. If you take this to an extreme then you can only get rid of all of these problems by giving each developer a full production stack of their very own. This is obviously impossibly expensive for anything past the most trivial setup. But eliminating even some of these issues makes it more likely you&#8217;ll catch bugs early and less likely you&#8217;ll have a bug on your hands that you can&#8217;t recreate locally. So we&#8217;ll aim for production like rather than a 100% copy.</p>
<p>Here&#8217;s a real example, a case insensitive file system. Grab a terminal prompt on your mac and type the following in an empty directory. Then do the same on a typical linux machine. All we&#8217;re doing is using touch to create a file.</p>
<pre>touch Test
touch test
ls
</pre>
<p>On you&#8217;re mac you&#8217;ll probably see:</p>
<pre>Test</pre>
<p>On your linux box you&#8217;re more likely to get:</p>
<pre>Test
test</pre>
<p>What? The mac treated Test and test as meaning the same thing. It wont let you have a file called test and one called Test in the same place. It&#8217;s case insensitive. But the linux machine didn&#8217;t have this problem. Now imagine we&#8217;re not dealing with empty files called test but either files you&#8217;re running code is creating at run time (a file cache maybe or a user uploaded file) or even more interestingly your source code files. Lets say you have git on a linux box in the corner of the office and someone checks in two files from a linux machine called Pages_controller.rb and pages_controller.rb. What happens when you get these to you&#8217;re mac? I haven&#8217;t actually tried this but it&#8217;s not going to end well. And imagine debugging this sort of issue? If you think this is all hypothetical I know about this little quirk exactly because I saw someone trying to fix a bug related to it.</p>
<p>What if the bug was because you had one version of lib_xml on your local development machine and a different one on production. Up to that point you might not even know what libxml was or how it got on your shiny apple laptop.</p>
<p>How many people can genuinely say they have never had a bug they could recreate on live and not on their development machine? Same code, different behaviour. Load and data often play a part in bugs like this as well but these can be isolated and tests created in at least some cases. Being pragmatic what we&#8217;re aiming for isn&#8217;t to eliminate all differences, it&#8217;s to get rid of those that are easy to eliminate.</p>
<h2>How can I do this?</h2>
<p>Virtualisation tools used to be cumbersome and expensive and generally not aimed at consumers. I&#8217;ve used both VMWare Fusion and VirtualBox on my mac and even compared to a few years ago these tools are increasingly easy to use. And VirtualBox is free and open source too. On top of that we now have tools like vagrant which I&#8217;ll give a quick example of here.</p>
<p><a href="http://vagrantup.com">Vagrant</a> for those that haven&#8217;t come across it yet describes itself thus:</p>
<blockquote>
<p>Vagrant uses Oracle’s VirtualBox to build configurable, lightweight, and portable virtual machines dynamically</p>
</blockquote>
<p>What it really is is a tool for quickly and painlessly building virtual machines based on sensible default configurations, and then providing programatic hooks for more advanced configuration. For instance you&#8217;ll have a configuration file to describe which ports you want forwarded and you can use Chef to install packages when the VM first boots. Once you have it installed it&#8217;s as easy as this to use</p>
<pre>vagrant box add lucid32 http://files.vagrantup.com/lucid32.box
vagrant init lucid32
vagrant up</pre>
<p>The first line downloads a 32bit Ubuntu disk image but you&#8217;ll only need to do that once. You&#8217;ll find lots of images for different distros too. The next two lines create and then boot a new headless virtual machine. That&#8217;s it.</p>
<pre>vagrant ssh</pre>
<p>Will let you jump straight into a ssh session with the new machine, for an idea of what else it can do here&#8217;s the help output:</p>
<pre>Tasks:
  vagrant box                        # Commands to manage system boxes
  vagrant destroy                    # Destroy the environment, deleting the create...
  vagrant halt                       # Halt the running VMs in the environment
  vagrant help [TASK]                # Describe available tasks or one specific task
  vagrant init [box_name] [box_url]  # Initializes the current folder for Vagrant u...
  vagrant package                    # Package a Vagrant environment for distribution
  vagrant provision                  # Rerun the provisioning scripts on a running VM
  vagrant reload                     # Reload the environment, halting it then rest...
  vagrant resume                     # Resume a suspended Vagrant environment.
  vagrant ssh                        # SSH into the currently running Vagrant envir...
  vagrant ssh_config                 # outputs .ssh/config valid syntax for connect...
  vagrant status                     # Shows the status of the current Vagrant envi...
  vagrant suspend                    # Suspend a running Vagrant environment.
  vagrant up                         # Creates the Vagrant environment
  vagrant version                    # Prints the Vagrant version information</pre>
<p>I&#8217;ll leave it their as this post is more of a rant than a tutorial, but I might write more about using vagrant later. But in the meantime read the web site for a pretty simple walkthrough. And don&#8217;t be put off by the fact it&#8217;s written in Ruby or that the example shows a Rails app, this is a great tool whatever language you&#8217;re going to be using on the virtual machine.</p>
<h2>Arguments against</h2>
<p>I see too few developers doing this for it to just be about a lack of awareness. Lots of developers not doing this might be running local virtual machines for cross browser testing for instance. Here&#8217;s a few complaints I&#8217;ve heard and what I think the answer is.</p>
<h3>Speed</h3>
<p>If something is slow and you don&#8217;t have as much <span class="caps">RAM</span> as you can get into your machine then do that before complaining about anything. Running a few extra operating systems inside your main operating system is obviously going to be intensive so don&#8217;t scrimp on your tools. Also the defaults when setting up new virtual machines in VirtualBox or VMWare Fusion at least are quite minimal. Try increasing the ammount of <span class="caps">RAM</span> you let them use or give them access to more processes. I can genuinely say I&#8217;ve had a problem with this once and the real solution was changing the code, not throwing away all the advantages of virtualisation. If you&#8217;re doing some crazy real time video processing thing then your mileage will vary, but then you probably want a faster machine anyway.</p>
<h3>Lower level that you&#8217;re used to</h3>
<blockquote>
<p>As a <span class="caps">PHP</span>/Ruby/Python developer why should I have to care about Apache? I just write code!</p>
</blockquote>
<p>This argument just bugs me, but I do know part of that is me. I need to know how all the bits work and fit together and I accept not everyone does, or indeed needs to understand everything. But someone on your team probably wants to know this stuff and importantly be able to tell others how they should do things. It&#8217;s pretty common for developers to setup a development environment for a pure frontend developer or a designer so they can make changes and commit <span class="caps">CSS</span> or new templates. This is no different. Most designers don&#8217;t need to know about the software environment in detail, it&#8217;s easier for them to defer to a domain expert. If a developer just wants to write code then they too should defer to someone who does know about the lower level when it comes to their development environment too.</p>
<h3>Something else to setup</h3>
<p>This argument has some merit. We&#8217;re all busy and downing tools to setup something for you and your team is time consuming. And I think until pretty recently the time taken and the knowledge needed was a genuine barrier. Personally I&#8217;ve tended to have few problems, but then I&#8217;m familiar enough with Linux administration to avoid some common pitfalls. But problems with setting up port forwarding or shared folders can be pretty irritating when you want to work on a pressing bug or shiny new feature. But with tools like vagrant providing a simple interface to do this I think this is hopefully a thing of the past.</p>
<h3>Developers workstations should be personal</h3>
<p>I agree up to a point here. Discussions of standardising individual developer tools turn into holy flame wars over whether everyone should use some <span class="caps">IDE</span>, Vim or Emacs (answer: Vim). This is pointless. File managers, utilities, test editors, terminal styles, host operating system. All of these and more should be up to the individual developers. But in the same way you generally don&#8217;t allow individual developers to use a new language no one knows without at least some discussion, why would this be different for the web server or operating system on which you&#8217;ll be running that code in production. Most of the time it&#8217;s not that developers make a consious decision to use a different version either. It&#8217;s more likely that they will take the path of least resistance and follow a tutorial or just use a package manager. It&#8217;s more likely if you ask the question &#8220;what specific version of Apache are you using on your development machine&#8221; they won&#8217;t know the answer.</p>
<h2>Conclusions</h2>
<p>I&#8217;ve not even gone into some of the other advantages of virtualisation here. Being able to snapshot your environment at any point and roll back an entire virtual machine like you do your code is hugely handy. As is the ability to create virtual machines that you can share with other members of your team. No more do new employees have to spend the first week installing dependencies and just getting code running.</p>
<p>I&#8217;m certainly not the only person doing this and it&#8217;s not a new idea. But it&#8217;s never been easier or cheaper. And with an increasing move towards virtualisation or cloud computing production environments it&#8217;s even easier to share good practices with your friendly systems administrators.</p>
<p>I&#8217;ve renabled comments on this blog after something of a break and I&#8217;d love to hear what people think, positive and negative.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/10/30/Chef-hello-world/">Chef Hello World</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-30T00:00:00+01:00" pubdate data-updated="true">Oct 30<span>th</span>, 2010</time>
        
         | <a href="/2010/10/30/Chef-hello-world/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve been playing with Chef recently, in particular the solo variant. The new job at FreeAgent meant setting up new development virtual machines and rather than just jot down instructions I decided to script everything. I&#8217;d been wanting an excuse to take a look at Chef for a while and it&#8217;s certainly suited to this sort of job.</p>
<p>Unfortunately the <em>getting started</em> documentation isn&#8217;t yet great. I&#8217;m pretty sure this will improve over time, I had exactly the same problem with the Puppet docs a year ago. The main problem I had was I wanted to know how to use it, not just how to download someone elses cookbook. What I wanted was the following, the absolute simplest thing that will work. A Hello World example for Chef if you will. I&#8217;ll say now that I&#8217;m not an expert, their may be ways of doing this that are even simpler, but this works for me. And before someone mentions knife or rake tasks a generator isn&#8217;t simpler. It might be better when you know what&#8217;s going on but until you do it&#8217;s a big ass abstraction that will just get in the way.</p>
<p>All my sample cookbook is going to do is install a single package, curl. I&#8217;m going to assume you have chef installed for this already. The documentation did an OK job of that, although I&#8217;m relativly familiar with installing gems. I did find that the default system packages on Ubuntu at least were way out of date. Either get the packages direct from opscode or use the gem.</p>
<p>First create a directory and file structure that looks like this:</p>
<pre>
-- config
   -- node.json
   -- solo.rb
-- cookbooks
   -- example
      -- recipes
         -- default.rb
</pre>
<p>When you run the chef-solo command you need to tell it a few bits of information. The minimum appears to be just telling it where to find the cookbook we&#8217;re going to create. I think you can call this file anything you like but in the tree above it&#8217;s called solo.rb.</p>
<pre>cookbook_path File.expand_path(File.join(File.dirname(__FILE__), '..', "    cookbooks"))</pre>
<p>Next up is the details of the given node. This in our very simple case is just a list of the recipes we want to run when we execure chef-solo. Put the following content in the node.json file in the config directory as indicated above:</p>
<pre>{
  "run_list": [ "recipe[example]" ]
}</pre>
<p>Last up we want to create a cookbook. Now you can go and download example cookbooks from all over the place. This is great for learning new tricks and commands but for me at least to begin with most of them were more complicated than I needed for my simple usecase. Lots of options. Lots of knowing the package names on different distros. I&#8217;m just calling this cookbook <em>example</em>. That means the folder in the cookbooks folder is called example and the run list above references example. Feel free to change this to whatever you like, or create new cookbooks with different names. Inside that folder we create a recipes folder and inside that we create a default.rb file with the following content.</p>
<pre>package "curl"</pre>
<p>And that&#8217;s it. A bigish directory structure, three files, each with about one line of content. Simple.</p>
<p>Now to run all that just issue the following command:</p>
<pre>sudo chef-solo -c config/solo.rb -j config/node.json</pre>
<p>This should output various messages to the console about what chef is doing and, when it&#8217;s finished, you should find curl has been installed. Try and add another line to the recipe for another package (or even a gem) and rerun the chef-solo command. Now go read the docs for all the other cool things you can do.</p></div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/6/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/4/">Newer &rarr;</a>
    
  </div>
</div>

    </div>
  </div>
  <footer role="contentinfo">
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'morethanseven';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
