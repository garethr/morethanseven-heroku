
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Morethanseven</title>
  <meta name="author" content="Gareth Rushgrove">

  
  <meta name="description" content="So one of the problems with using pip or easy_install as part of an automated deployment process is they rely on an internet connection. More than &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.morethanseven.net/page/10">
  <link href="/favicon.ico" rel="icon">
  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/articles.atom" rel="alternate" title="Morethanseven" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<meta content="etkmKMftqAyYJM6-DP_TTKJjV0EHM5vbVcaOloSo8Z8" name="google-site-verification">
<link href="http://www.myopenid.com/server" rel="openid.server">
<link href="http://garethr.myopenid.com/" rel="openid.delegate">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-435455-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header>
<hgroup>
<h1><a href="/">Morethanseven</a></h1>
<p>The blog of Gareth Rushgrove</p>

<div id='carbonads-container'>
  <div class='carbonad'>
    <div id='carbon'></div>
    <script type='text/javascript'>
      //<![CDATA[
        var z = document.createElement("script");
        z.type = "text/javascript";
        z.async = true;
        z.src = "http://engine.carbonads.com/z/12119/carbon_2_1_0_HORIZ";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(z, s);
      //]]>
    </script>
  </div>
</div>

</hgroup>
</header>


  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/08/15/your-own-pypi-server/">Your Own PyPi Server</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-08-15T00:00:00+01:00" pubdate data-updated="true">Aug 15<span>th</span>, 2009</time>
        
         | <a href="/2009/08/15/your-own-pypi-server/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So one of the problems with using pip or easy_install as part of an automated deployment process is they rely on an internet connection. More than that, they rely on PyPi being up as it&#8217;s a centralised system, unlike all the apt package mirrors.</p>
<p>The best solution seems to be to host your own PyPi compliant server. Not only can you load all the third party modules you use onto it, but you could also upload any internal applications or libraries that you like. By running this on your local network you ensure your not dependent on pypi or an internet connection.</p>
<p>At the moment I&#8217;m playing with <a href="http://github.com/ask/chishop/tree/master">Chishop</a> which is a django application for maintaining a PyPi compatible server. Another alternative if that doesn&#8217;t work out is <a href="http://pypi.python.org/pypi/EggBasket/">EggBasket</a></p>
<p>To install from your own PyPi server you can specify the location of your Chishop instance with the -i flag.</p>
<pre>easy_install -i http://localhost:8000/ PACKAGE_NAME</pre>
<p>This will fall back to the PyPi server if it doesn&#8217;t find the relevant package. If you want to stop that behaviour and make sure you have a local package then you can limit the hosts with the -H flag like so.</p>
<pre>easy_install -H localhost:8000 -i http::/localhost:8000/ PACKAGE_NAME</pre>
<p>I&#8217;m not yet sure how to do this with pip, if someone wants to enlighten me in the comments then I&#8217;d be most grateful.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/07/27/fabric-django-git-apache-mod-wsgi-virtualenv-and-p/">Fabric, Django, Git, Apache, Mod_wsgi, Virtualenv and Pip Deployment</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-27T00:00:00+01:00" pubdate data-updated="true">Jul 27<span>th</span>, 2009</time>
        
         | <a href="/2009/07/27/fabric-django-git-apache-mod-wsgi-virtualenv-and-p/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve been playing with automating Django deployments again, this time using <a href="http://fabfile.org/">Fabric</a>. I found a number of examples on the web but non of them quite fit the bill for me. I don&#8217;t like serving directly from a repository, I like to have either a package or tar I can use to say &#8220;that is what went to the server&#8221;. I also like having a quick rollback command as well as being able to deploy a particular version of the code when the need arises. I also wanted to go from a clean ubuntu install (plus <span class="caps">SSH</span>) to a running Django application in one command from the local development machine. The Apache side of things is nicely documented in <a href="http://gist.github.com/106077">this Gist</a> which made a good starting point.</p>
<p>I&#8217;m still missing a few things in this setup mind and at the moment you still have to setup your local machine yourself. I&#8217;m probably going to create a paster template and another fabfile to do that I think. The instructions are a little rough as well at the moment and I&#8217;ve left the database out of it as everyone has there own preference.</p>
<p>This particular fabric file makes setting up and deploying a django application much easier, but it does make a few assumptions. Namely that you&#8217;re using Git, Apache and mod_wsgi and your using Debian or Ubuntu. Also you should have  Django installed on your local machine and <span class="caps">SSH</span> installed on both the local machine and any servers you want to deploy to.</p>
<p><em>note that I&#8217;ve used the name project_name throughout this example. Replace this with whatever your project is called.</em></p>
<p>First step is to create your project locally:</p>
<pre>mkdir project_name
cd project_name
django-admin.py startproject project_name</pre>
<p>Now add a requirements file so pip knows to install Django. You&#8217;ll probably add other required modules in here later. Creat a file called requirements.txt and save it at the top level with the following contents:</p>
<pre>Django</pre>
<p>Then save this fabfile.py file in the top level directory which should give you:</p>
<pre>project_name
    fabfile.py
    requirements.txt
    project_name
        __init__.py
        manage.py
        settings.py
        urls.py</pre>
<p>You&#8217;ll need a <span class="caps">WSGI</span> file called project_name.wsgi, where project_name  is the name you gave to your django project. It will probably look like the following, depending on your specific paths and the location of your settings module</p>
<pre>import os
import sys
# put the Django project on sys.path
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), "../")))
os.environ["DJANGO_SETTINGS_MODULE"] = "project_name.settings"
from django.core.handlers.wsgi import WSGIHandler
application = WSGIHandler()</pre>
<p>Last but not least you&#8217;ll want a virtualhost file for apache which looks  something like the following. Save this as project_name in the inner directory. You&#8217;ll want to change /path/to/project_name/ to the location on the remote server you intent to deploy to.</p>
<pre>&lt;VirtualHost *:80&gt;
        WSGIDaemonProcess project_name-production user=project_name group=project_name threads=10 python-path=/path/to/project_name/lib/python2.6/site-packages
        WSGIProcessGroup project_name-production
        WSGIScriptAlias / /path/to/project_name/releases/current/project_name/project_name.wsgi
        &lt;Directory /path/to/project_name/releases/current/project_name&gt;
            Order deny,allow
            Allow from all
        &lt;/Directory&gt;
        ErrorLog /var/log/apache2/error.log
        LogLevel warn
        CustomLog /var/log/apache2/access.log combined
&lt;/VirtualHost&gt;</pre>
<p>Now create a file called .gitignore, containing the following. This prevents the compiled python code being included in the repository and the archive we use for deployment.</p>
<pre>*.pyc</pre>
<p>You should now be ready to initialise a git repository in the top level project_name directory.</p>
<pre>git init
git add .gitignore project_name
git commit -m "Initial commit"</pre>
<p>All of that should leave you with</p>
<pre>project_name
    .git
    .gitignore
    requirements.txt
    fabfile.py
    project_name
        __init__.py
        project_name
        project_name.wsgi
        manage.py
        settings.py
        urls.py</pre>
<p>In reality you might prefer to keep your wsgi files and virtual host files elsewhere. The fabfile has a variable (config.virtualhost_path) for this case.  You&#8217;ll also want to set the hosts that you intend to deploy to (config.hosts) as well as the user (config.user).</p>
<p>The first task we&#8217;re interested in is called setup. It installs all the  required software on the remote machine, then deploys your code and restarts the webserver.</p>
<pre>fab local setup</pre>
<p>After you&#8217;ve made a few changes and commit them to the master Git branch you can run to deply the changes.</p>
<pre>fab local deploy</pre>
<p>If something is wrong then you can rollback to the previous version.</p>
<pre>fab local rollback</pre>
<p>Note that this only allows you to rollback to the release immediately before the latest one. If you want to pick a arbitrary release then you can use the following, where 20090727170527 is a timestamp for an existing release.</p>
<pre>fab local deploy_version:20090727170527</pre>
<p>If you want to ensure your tests run before you make a deployment then you can do the following.</p>
<pre>fab local test deploy</pre>
<p>The actual fabfile looks like this. I&#8217;ve uploaded a <a href="http://gist.github.com/156623">Gist of it</a>, along with the docs, so if you want to improve it please clone it.</p>
<pre># globals
config.project_name = 'project_name'
# environments
def local():
    "Use the local virtual server"
    config.hosts = ['172.16.142.130']
    config.path = '/path/to/project_name'
    config.user = 'garethr'
    config.virtualhost_path = "/"
# tasks
def test():
    "Run the test suite and bail out if it fails"
    local("cd $(project_name); python manage.py test", fail="abort")
def setup():
    """
    Setup a fresh virtualenv as well as a few useful directories, then run
    a full deployment
    """
    require('hosts', provided_by=[local])
    require('path')
    sudo('aptitude install -y python-setuptools')
    sudo('easy_install pip')
    sudo('pip install virtualenv')
    sudo('aptitude install -y apache2')
    sudo('aptitude install -y libapache2-mod-wsgi')
    # we want rid of the defult apache config
    sudo('cd /etc/apache2/sites-available/; a2dissite default;')
    run('mkdir -p $(path); cd $(path); virtualenv .;')
    run('cd $(path); mkdir releases; mkdir shared; mkdir packages;', fail='ignore')
    deploy()
def deploy():
    """
    Deploy the latest version of the site to the servers, install any
    required third party modules, install the virtual host and 
    then restart the webserver
    """
    require('hosts', provided_by=[local])
    require('path')
    import time
    config.release = time.strftime('%Y%m%d%H%M%S')
    upload_tar_from_git()
    install_requirements()
    install_site()
    symlink_current_release()
    migrate()
    restart_webserver()
def deploy_version(version):
    "Specify a specific version to be made live"
    require('hosts', provided_by=[local])
    require('path')
    config.version = version
    run('cd $(path); rm releases/previous; mv releases/current releases/previous;')
    run('cd $(path); ln -s $(version) releases/current')
    restart_webserver()
def rollback():
    """
    Limited rollback capability. Simple loads the previously current
    version of the code. Rolling back again will swap between the two.
    """
    require('hosts', provided_by=[local])
    require('path')
    run('cd $(path); mv releases/current releases/_previous;')
    run('cd $(path); mv releases/previous releases/current;')
    run('cd $(path); mv releases/_previous releases/previous;')
    restart_webserver()    
# Helpers. These are called by other functions rather than directly
def upload_tar_from_git():
    require('release', provided_by=[deploy, setup])
    "Create an archive from the current Git master branch and upload it"
    local('git archive --format=tar master | gzip &gt; $(release).tar.gz')
    run('mkdir $(path)/releases/$(release)')
    put('$(release).tar.gz', '$(path)/packages/')
    run('cd $(path)/releases/$(release) &amp;&amp; tar zxf ../../packages/$(release).tar.gz')
    local('rm $(release).tar.gz')
def install_site():
    "Add the virtualhost file to apache"
    require('release', provided_by=[deploy, setup])
    sudo('cd $(path)/releases/$(release); cp $(project_name)$(virtualhost_path)$(project_name) /etc/apache2/sites-available/')
    sudo('cd /etc/apache2/sites-available/; a2ensite $(project_name)') 
def install_requirements():
    "Install the required packages from the requirements file using pip"
    require('release', provided_by=[deploy, setup])
    run('cd $(path); pip install -E . -r ./releases/$(release)/requirements.txt')
def symlink_current_release():
    "Symlink our current release"
    require('release', provided_by=[deploy, setup])
    run('cd $(path); rm releases/previous; mv releases/current releases/previous;', fail='ignore')
    run('cd $(path); ln -s $(release) releases/current')
def migrate():
    "Update the database"
    require('project_name')
    run('cd $(path)/releases/current/$(project_name);  ../../../bin/python manage.py syncdb --noinput')
def restart_webserver():
    "Restart the web server"
    sudo('/etc/init.d/apache2 restart')
</pre></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/07/23/whats-new-django-11/">What&#8217;s New in Django 1.1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-23T00:00:00+01:00" pubdate data-updated="true">Jul 23<span>rd</span>, 2009</time>
        
         | <a href="/2009/07/23/whats-new-django-11/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>With the <a href="http://www.djangoproject.com/weblog/2009/jul/21/rc/">release candidate for Django 1.1</a> out the door I decided to have a quick look at what&#8217;s new. This isn&#8217;t a complete list, rather the bits I found most interesting.</p>
<h2><a href="http://docs.djangoproject.com/en/dev/topics/conditional-view-processing/">Conditional Views</a></h2>
<blockquote>
<p>Django now has much better support for conditional view processing using the standard ETag and Last-Modified <span class="caps">HTTP</span> headers. This means you can now easily short-circuit view processing by testing less-expensive conditions. For many views this can lead to a serious improvement in speed and reduction in bandwidth.</p>
</blockquote>
<p>A nice set of decorators for dealing with ETags and Last-Modified headers. Again very simple to use and set up, and a simple way of squeezing a little more performance out of you application.</p>
<h2><a href="http://docs.djangoproject.com/en/dev/ref/contrib/admin/actions/#ref-contrib-admin-actions">Admin Actions</a></h2>
<blockquote>
<p>The basic workflow of Django’s admin is, in a nutshell, “select an object, then change it.” This works well for a majority of use cases. However, if you need to make the same change to many objects at once, this workflow can be quite tedious. In these cases, Django’s admin lets you write and register “actions” – simple functions that get called with a list of objects selected on the change list page.</p>
</blockquote>
<p>Anything that makes the admin a little more powerful and a little more flexible is a good idea in my book. Admin actions allow you to run code over multiple objects at once, simple select them with a checkbox then select an action to run. This is worth it for the delete action alone, but you can write your own actions simply enough as well (for instance for approving a batch of comments, or archiving a set or articles.)</p>
<h2><a href="http://docs.djangoproject.com/en/dev/ref/contrib/admin/#admin-list-editable">Editable Admin List Items</a></h2>
<blockquote>
<p>You can now make fields editable on the admin list views via the new list_editable admin option. These fields will show up as form widgets on the list pages, and can be edited and saved in bulk.</p>
</blockquote>
<p>Another time saving admin addition, this time for making some fields editable from the change list rather than the object view. For quick changes, especially to boolean fields, I think this again is a nice addition.</p>
<h2><a href="http://docs.djangoproject.com/en/dev/ref/models/options/#django.db.models.Options.managed">Unmanaged Models</a></h2>
<blockquote>
<p>You can now control whether or not Django creates database tables for a model using the managed model option. This defaults to True, meaning that Django will create the appropriate database tables in syncdb and remove them as part of reset command. That is, Django manages the database table’s lifecycle. If you set this to False, however, no database table creating or deletion will be automatically performed for this model. This is useful if the model represents an existing table or a database view that has been created by some other means.</p>
</blockquote>
<p>I particularly like this addition. One of the issues I had with Django was some of the built in assumptions, in particular that you&#8217;d be using a <span class="caps">SQL</span> database backend. Using unmanaged models looks like a great approach to using an alternative database like couchdb, tokyotyrant or mongodb or representing a webservice interface in your application.</p>
<p>I&#8217;m sure I&#8217;ll have missed a few other interesting changes or additions. Anyone else have a favourite?</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/07/15/simple-app-running-scripts-and-recording-results/">Asteroid - Simple App for Running Scripts and Recording the Results</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-15T00:00:00+01:00" pubdate data-updated="true">Jul 15<span>th</span>, 2009</time>
        
         | <a href="/2009/07/15/simple-app-running-scripts-and-recording-results/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Asteroid is a simple web interface for running scripts and recording the results. It&#8217;s like a much simpler and more general purpose version of something like Cruise Control. You can <a href="http://github.com/garethr/Asteroid/tree/master">get the code on Github</a>.</p>
<p><img src="http://image-host.appspot.com/i/img?id=agppbWFnZS1ob3N0cgwLEgVJbWFnZRj5VQw" alt="Asteroid Dashboard"/></p>
<p>I built it to solve two main problems:</p>
<ul>
	<li>It&#8217;s sometimes useful to have a historical record of a scripts execution, in particular whether it passed or failed and what the output was. Just running a command line script probably doesn&#8217;t give you that. It&#8217;s also useful to have a more graphical interface for those members of the team who don&#8217;t use the command line.</li>
	<li>When working in a team you often want to run scripts against shared infrastructure, for instance deploying a testing release or running a test suite. Seeing what is running at present helps with that.</li>
</ul>
<p>So it should be useful for running deployments, running test suites, running backups, etc. It currently doesn&#8217;t have scheduling or similar build in, but as everything is triggered by hitting a <span class="caps">URL</span> it would be simple enough to use cron for something like that. It should also be useful whatever language you write your scripts in; rake, ant, shell scripts, etc. At the end of the day it just executes a command at the console.</p>
<h2>Requirements</h2>
<p>Asteroid uses the Django Python framework under the hood.</p>
<ul>
	<li>Django &#8211; <a href="http://www.djangoproject.com/">http://www.djangoproject.com/</a></li>
</ul>
<p>You&#8217;ll also need a database. The default in the shipped settings is to use sqlite but this should work with any database supported by Django.</p>
<p>You&#8217;ll also need a decent web browser. I&#8217;ve gone and used HTML5 as an experiment and with this being a developer tool I&#8217;m hoping to stick with it. It would be easy enough to convert the templates if this is a problem however.</p>
<p>The application has an optional message queue backend which can be enabled in the settings file. This is used to improve the responsiveness of the application as well as allow commands to be executed on a remote machine, rather than on the box Asteroid is running.</p>
<ul>
	<li>AMQPlib &#8211; <a href="http://barryp.org/software/py-amqplib/">http://barryp.org/software/py-amqplib/</a></li>
	<li>RabbitMQ &#8211; <a href="http://www.rabbitmq.com/">http://www.rabbitmq.com/</a></li>
</ul>
<p>Other <span class="caps">AMQP</span> compliant message queues should work but it&#8217;s currently only tested with Rabbit.</p>
<p>If you are intending to do any development on Asteroid, or just want to look more closely at the code, I&#8217;d recommend installing</p>
<ul>
	<li>Clue &#8211; <a href="http://github.com/garethr/django-clue/tree/master">http://github.com/garethr/django-clue/tree/master</a></li>
	<li>Test Extensions &#8211; <a href="http://github.com/garethr/django-test-extensions/tree/master">http://github.com/garethr/django-test-extensions/tree/master</a></li>
</ul>
<h2>Usage Instructions</h2>
<p>You should be able to just download asteroid and run it from wherever you put it, once you setup the database.</p>
<pre>cd asteroid/configs/common
manage.py syncdb
manage.py runserver</pre>
<p>This should bring the local web server up on port 8000 so visit http://localhost:8000 and see.</p>
<p>If you&#8217;re using the message queue backend you&#8217;ll need to run the listener script in order to get your commands executed. At the moment that means modifying a constant in the listener script to point at a running message queue instance at asteroid/bin/asteroid_listen.py.</p>
<pre>cd asteroid/bin
./asteroid_listen.py</pre>
<p>Once you&#8217;re up and running you should be able to add commands via the admin interface at http://localhost:8000/admin/. The username and password should be those you added when creating the database via the syncdb command above.</p>
<p>The development configs include a few additional applications (mentioned above) which I use for testing and debugging. You can run the test suite like so:</p>
<pre>cd asteroid/configs/development
manage.py test --coverage
</pre>
<h2>Todo</h2>
<p>This is an early release that just about <em>works for me</em>. I can already see a number of areas I&#8217;d like to clean up a little or extend. For instance:</p>
<ul>
	<li>Other deployment options, including a <span class="caps">WSGI</span> file and a spawning startup script.</li>
	<li>Use a database migration system to make upgrades easier.</li>
	<li>Make the message queue listener script more robust.</li>
	<li>Make the command entry more robust, it sometimes takes a bit of fiddling with to get something to run correctly.</li>
	<li>Formalise running scripts on remote machines, including support for running on multiple machines.</li>
	<li>Paging for long lists of commands or runs.</li>
</ul>
<h2>Notes</h2>
<p>I&#8217;m pretty happy with how it&#8217;s shaping up so far. Under the hood it works by having the web app put a <span class="caps">JSON</span> document on the message queue. The <span class="caps">JSON</span> contains the command to be run and a callback <span class="caps">URL</span>. The script listening to the message queue picks up the message, runs the command, and posts a <span class="caps">JSON</span> document back to the webhook url. It keeps the web interface snappy, as well as meaning it can show which commands are currently in progress at any given time. It also has the side benefit of meaning you can execute commands on a remote machine, as the listener doesn&#8217;t care where it&#8217;s running.</p>
<p>As noted above I have a few ideas of where I want to take it, but I&#8217;m going to try using it for a bit and see how that goes. If anyone else finds it useful then do let me know.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/07/13/its-data-we-want/">It&#8217;s the Data We Want</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-13T00:00:00+01:00" pubdate data-updated="true">Jul 13<span>th</span>, 2009</time>
        
         | <a href="/2009/07/13/its-data-we-want/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote>
<p>A spreadsheet. A <span class="caps">CSV</span> file. Whatever is in use internally. Made available to people like us under a suitable license.</p>
</blockquote>
<p>I feel a little self adsorbed quoting myself (from a recent <a href="http://refreshcambridge.org/">Refresh Cambridge</a> discussion) but I did like the turn of phrase. What I was rambling on about was Cambridge County mapping data, after a question from a nice chap from the council about what <em>&#8220;new, exciting map technology&#8221;</em> we&#8217;d like to see. But it applies to any data that you&#8217;re trying to make public what-so-ever, be it government or otherwise.</p>
<p>What myself and a few other people were talking about, and one of the things that has been discussed as part of the <a href="http://rewiredstate.org/">Rewired State</a> group, is that it&#8217;s all about the data, not necessarily about a nice web based <span class="caps">API</span>.</p>
<p>Now I&#8217;ve written and spoken about the need for well designed API&#8217;s being treated as part of the user interface. But remember interface design, and by association <span class="caps">API</span> design, isn&#8217;t easy. <span class="caps">API</span> design is often about building manageable flexibility. A public <span class="caps">API</span> is often about managing the flow of data you control out to third parties, as well as the information itself it might include limitations on usage, or request rate, or storage. A public <span class="caps">API</span> codifies how that information can be accessed. APIs also have to tread a fine line between making it easy for you to solve your problem, and making it easy for everyone else to solve their completely different problems. These compromises are design.</p>
<p>But not everything needs an <span class="caps">API</span>. Sometimes it&#8217;s just about the data, and the best way of getting at that data is as raw as possible. Government data is an easy sell here, as it is (or rather should be) <em>our</em> data. It&#8217;s also for the most part interesting to read rather than write (historical council tax data, or population data for instance). Raw data can generally be provided quicker than via an <span class="caps">API</span>. It doesn&#8217;t need fragile computer systems or extensive manual labour. It doesn&#8217;t need particularly clever computing resources. Just upload a spreadsheet or a <span class="caps">CSV</span> file to a sensible <span class="caps">URL</span> on a known, regular basis and away we go.</p>
<p>And giving data like this away to the development community is likely to have a few additional benefits if that data is useful (it probably is to someone). We&#8217;ll happily write software libraries, or create APIs over the top of it for you. We&#8217;ll also write all sorts of useful tools using the data in ways no one else thought of. So if you&#8217;re sat on a load of data that&#8217;s not core to your business, or is meant to be public anyway, then lets start talking publicly about how to just get this out on the web quickly and cheaply, rather than spending lots of your time and money on something fancy.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/07/08/thoughts-whole-xhtml-and-html5-affair/">Thoughts on the Whole XHTML/HTML5 Affair</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-08T00:00:00+01:00" pubdate data-updated="true">Jul 8<span>th</span>, 2009</time>
        
         | <a href="/2009/07/08/thoughts-whole-xhtml-and-html5-affair/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I wasn&#8217;t going to write anything about <a href="http://www.w3.org/News/2009#item119">the whole XHTML2 thing</a>. I noted its passing, got <a href="https://twitter.com/jamierumbelow/status/2442111140">a nice message on Twitter</a> and thought that would be it. But no. The web standards world exploded. I honestly didn&#8217;t see that coming.</p>
<p>Let&#8217;s get a few things straight:</p>
<ul>
	<li>I use <span class="caps">XHTML</span> 1.0 for this site. In fact I&#8217;ve been using it for the majority of things for most of my professional life.</li>
	<li>I don&#8217;t serve content with an <span class="caps">XML</span> mime type. Neither does <em>anyone</em> else. It&#8217;s a complete non issue. Ignore it.</li>
	<li>At my last job we used <span class="caps">HTML</span> 4. It meant I had to remember not to close my image elements, which bugged me, but not too much. I still quoted everything. Closed everything I could. And only used lowercase element names.</li>
	<li>My latest two pet projects are using HTML5. I&#8217;m still closing everything (including image elements, yay), quoting everything and lowercasing everything.</li>
</ul>
<p>Web Standards are interesting, in that they are standards for both implementors (browser makers) and for authors (us). I like coding standards in programming languages too, it&#8217;s one of the things I love about Python and <a href="http://www.python.org/dev/peps/pep-0008/">PEP8</a>. But with these standards it&#8217;s not about making your code <em>work</em>, it&#8217;s about shared conventions and readability. So common spacing, <span class="caps">UPPERCASE</span> for constants and Leading caps for class names for instance. It&#8217;s also about having a tool to check everyone is adhering to standards, like <a href="http://svn.browsershots.org/trunk/devtools/pep8/pep8.py">pep8.py</a> or <span class="caps">FXCOP</span> for .<span class="caps">NET</span>. If everyone writes code in the same way it&#8217;s easier to read, write and to pick up someone else&#8217; code. You can do that with <span class="caps">HTML</span>, but you <em>have</em> to do that with <span class="caps">XHML</span>.</p>
<p>Now the whole <span class="caps">HTML</span> 4.0 vs <span class="caps">XHTML</span> 1.0 thing has come up lots of times, on mailing lists, at conferences as well as down the pub. I know on occasion me, <a href="http://allinthehead.com">Drew</a>, <a href="http://rachelandrew.co.uk">Rachel</a> and <a href="http://adactio.com">Jeremy</a> side against <a href="http://simonwillison.net">Simon</a> and <a href="http://natbat.net">Nat</a> on the issue. But what&#8217;s interesting is that I think we all agree on all the typographical conventions stuff. My <a href="http://intranation.com">former</a> <a href="http://thecssdiv.com">colleagues</a> with a passion for front end standards and <span class="caps">HTML</span> 4 did the same thing. I even remember Simon looking for ways to validate against <span class="caps">HTML</span> 4 but also to check for all lower case elements, closed paragraphs and the like.</p>
<p>Which brings me to the reason why I use <span class="caps">XHTML</span>: The validator enforces my preferred coding standards for <span class="caps">HTML</span> &#8211; lowercase elements, quoted attributes and closed elements. That&#8217;s it. Not much really. I <em>know</em> it&#8217;s <a href="http://hsivonen.iki.fi/xhtml2-html5-q-and-a/">marketing <span class="caps">XHTML</span> rather than technical <span class="caps">XHTML</span></a>. I don&#8217;t care. Or rather I do care, I just make a conscious pragmatic decision based on a small personal advantage. I&#8217;m both pedantic and like having a tool chain which enforces that, <span class="caps">XHTML</span> suits my style.</p>
<p>The markup language debate is being talked about in terms of pragmatists vs purists. But ignoring the people who both really understood and really wanted XHTML2, it&#8217;s mainly the pragmatists arguing amongst themselves now. Some of them are big company people, others working for themselves. Some have standards or academic leanings, others are rooted in commercial web design. Some people probably work on huge long term projects, others relatively small sites and apps. And I think it&#8217;s these cultural differences that are the root of arguments now. So blog posts coming out saying the same thing but arguing with other people give a strange impression of disagreement. Throw in that the web lends itself to popular blogs gathering a crowd of like-minded people around them and hey presto we have people feeling unfairly put upon and getting agitated.</p>
<p>What a storm in a teacup. Who doesn&#8217;t genuinely think the best approach is to use whatever you&#8217;re using now for most projects, investigate HTML5 as time permits, and then expect to start using HTML5 in bits and pieces in the short to medium term, when being mainly dependent on your target audience?</p>
<p>In my opinion the only genuine problem that this saga has highlighted is the fear, uncertainty and doubt around all flavours of <span class="caps">HTML</span> amongst a large number of web professionals. People don&#8217;t get this stuff at all. With the added resources soon to be put into the HTML5 working group at the W3C this <em>outreach and education</em> side of the project has to have just as much love and attention as the spec itself.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/07/01/pants-python-code/">Pants Python Code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-01T00:00:00+01:00" pubdate data-updated="true">Jul 1<span>st</span>, 2009</time>
        
         | <a href="/2009/07/01/pants-python-code/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the projects that came out of the <a href="http://alt.djangodash.com/">Django Dash</a> recently was <a href="http://pypants.org">PyPants</a> which I&#8217;m finding very cool.</p>
<p><img src="http://image-host.appspot.com/i/img?id=agppbWFnZS1ob3N0cgwLEgVJbWFnZRiRTgw" alt="Urltest on PyPants"/></p>
<p>It&#8217;s basically a quality tracking service for Python modules. For instance my recent <a href="http://pypants.org/projects/urltest/0.2.3/evaluations/3142/">UrlTest module has a page on PyPants</a>, scoring a good B grade after some cleanup work earlier today.</p>
<p>Under the hood I think it&#8217;s probably <a href="http://pycheesecake.org/">CheeseCake</a> which is available as a command line application, maybe with a hint of <a href="http://pypi.python.org/pypi/pylint">PyLint</a> and <a href="http://svn.browsershots.org/trunk/devtools/pep8/pep8.py">pep8.py</a> thrown in. But the nice interface, as well as tracking of scores over time, really add something. GitHub has been credited by some as making sharing code more fun, I&#8217;m hoping projects like PyPants can do the same for quality in Python code.</p>
<p>Congrats to <a href="http://ericholscher.com/">Eric Holscher</a>, <a href="http://traviscline.com/">Travis Cline</a>, and <a href="http://playgroundblues.com/">Nathan Borror</a> on a fantastic addition to the Python community.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/06/24/urltest-pypi/">Urltest on PyPi</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-06-24T00:00:00+01:00" pubdate data-updated="true">Jun 24<span>th</span>, 2009</time>
        
         | <a href="/2009/06/24/urltest-pypi/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve been meaning to add some of my code to the <a href="http://pypi.python.org">Python Package Index</a> for a while and  have finally gotten around to it with <a href="http://github.com/garethr/urltest/tree/master">Urltest</a>, my simple <span class="caps">DSL</span> for testing <span class="caps">WSGI</span> apps.</p>
<p>You can now find it at <a href="http://pypi.python.org/pypi/urltest">pypi.python.org/pypi/urltest</a> and install it using setuptools with:</p>
<pre>easy_install urltest</pre>
<p>At the moment I&#8217;ve not added any categorisation or detailed description to the setup.py file, I&#8217;ll be doing that soon. I wanted to get it working with the absolute minimum setup.py file, which turned out to look like:</p>
<pre>#!/usr/bin/env python
from setuptools import setup, find_packages
setup(
    name = "urltest",
    version = "0.1",
    author = "Gareth Rushgrove",
    author_email = "gareth@morethanseven.net",    
    url = "http://github.com/garethr/urltest",
    packages = find_packages('src'),
    package_dir = {'':'src'},
)</pre>
<p>Uploading it to <span class="caps">PYPI</span> itself was incredibly simple, partly as I was already using setup tools for local installation.</p>
<pre>python setup.py register
python setup.py bdist_egg upload</pre>
<p>Let me know if anyone uses this and gets it working. I&#8217;ll be adding more details and maybe even some more features when I get the chance. Once I do that I&#8217;ll probably work on a few more packages as well.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/06/23/ant-web-developers-ii-restart-apache/">Ant for Web Developers II - Restart Apache</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-06-23T00:00:00+01:00" pubdate data-updated="true">Jun 23<span>rd</span>, 2009</time>
        
         | <a href="/2009/06/23/ant-web-developers-ii-restart-apache/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Following on from <a href="http://morethanseven.net/2009/06/22/ant-web-developers-i-backup-config-file/">yesterdays first useful ant task</a>, here&#8217;s another commonly used task &#8211; restarting a remote service. I&#8217;ve used apache in this example, but it could be any service running on your remote machine and it doesn&#8217;t have to be the restart command.</p>
<p>In order to do this we&#8217;ll use the <a href="http://ant.apache.org/manual/OptionalTasks/sshexec.html">sshexec target</a> which has a third party <a href="http://ant.apache.org/manual/install.html#librarydependencies">library dependency</a>. This is the same third party library needed for the scp task in yesterdays post</p>
<p>You need first to download <a href="http://www.jcraft.com/jsch/index.html"><span class="caps">JSCH</span></a> and then compile the source using ant. Just run <em>ant dist</em> in the downloaded folder and you should get a .jar file in the /dist/lib folder. Save this .jar file as as jsch.jar to a folder in your home directory <em>~/.ant/lib</em> where ant can automatically load it. Alternatively you can run ant with the -lib command to load libraries from a different location.</p>
<pre>ant -lib /tools/ant-libraries</pre>
<p>With that out of the way lets have a look at the task.</p>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="example" basedir="."&gt;
&lt;property name="host" value="{host}"/&gt;
&lt;property name="username" value="{user}"/&gt;
&lt;property name="password" value="{password}"/&gt;
&lt;target name="restart-apache" description="execute a remote command to restart apache"&gt;
        &lt;sshexec host="${host}"
            username="${username}"
            password="${password}"
            command="/etc/init.d/apache2 restart"/&gt;
&lt;/target&gt;
&lt;/project&gt;</pre>
<p>And running it is as simple as:</p>
<pre>ant restart-apache</pre>
<p>One potential issue with tasks like this is storing the password in the build file in plain text. The target we&#8217;re using can also use key authentication is you&#8217;re happy using ssh keys. Alternatively you can set properties on the command line each time you run ant like so.</p>
<pre>ant restart-apache -Dpassword={password}
</pre></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/06/22/ant-web-developers-i-backup-config-file/">Ant for Web Developers I - Backup Config File</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-06-22T00:00:00+01:00" pubdate data-updated="true">Jun 22<span>nd</span>, 2009</time>
        
         | <a href="/2009/06/22/ant-web-developers-i-backup-config-file/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I occasionally get <a href="http://morethanseven.net/2009/01/24/defence-apache-ant/">carried away</a> with <a href="http://ant.apache.org/">Apache Ant</a>. For those that haven&#8217;t come across it, Ant is a build tool written in Java, using an <span class="caps">XML</span> syntax to describe a series of repeatable tasks. In your typical web standards savvy, dynamic language favouring, web developer types that description is probably all they (think they) need to know. It&#8217;s Java. It&#8217;s <span class="caps">XML</span>. It&#8217;s only really useful in the context of building software (dull).</p>
<p>But I think Ant is a particularly handy tool to have around for anyone working on even simple websites. A couple of strong use cases come to mind:</p>
<ul>
	<li>If you&#8217;re working in a team environment then build files are hugely useful when introducing new people to the team, or when moving people around. Getting code up and running at the start of a project, or if you join the team part way through, can be tricky. A well written build file can automate this.</li>
	<li>Even when working on projects on my own I tend to write simple build files. The main reason is so I don&#8217;t forget how to do something. How do you deploy this particular site? How do you run the test suite or generate the documentation? Build files can encapsulate this, and rather than documentation that might be out of date the build file will be executed to do that job in question.</li>
</ul>
<p>So with all that in mind I&#8217;m going to try and do a series of posts each covering a single task, aiming to cover things that your regular web developer will find useful. With that in mind if anyone has any requests or questions let me know either by email or in the comments.</p>
<p>Out first task lets us backup a file from our remote web server, in this case it&#8217;s the apache2.conf file used to setup apache. Obviously it could be any file you want to get hold of. The example below has a couple of properties for the username and hostname of the remote machine. Save the following snippet into a file called build.xml and place it anywhere you like on your machine.</p>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="example" basedir="."&gt;
&lt;property name="username" value="{user}"/&gt;
&lt;property name="host" value="{host}"/&gt;
&lt;target name="backup-apacheconf" description="backup apache2.conf file from a remote server"&gt;
  &lt;exec executable="scp" dir="." failonerror="true"&gt;
    &lt;arg value="${username}@${host}:/etc/apache2/apache2.conf"/&gt;
    &lt;arg value="apache2.conf"/&gt;
  &lt;/exec&gt;
&lt;/target&gt;
&lt;/project&gt;</pre>
<p>Running the task, once you have ant installed (it comes already installed on OS X and is generally available in whatever linux package management system you prefer), is as simple as typing the following into a console.</p>
<pre>ant backup-apacheconf</pre>
<p>This should download the apache2.conf file to you local machine, into the same directory as your build file.</p>
<p>The above task requires that you have scp installed on your machine, which is pretty likely if you&#8217;re using OS X or Linux. Ant comes with an inbuilt <em>scp</em> task, but it requires you to install a separate java library. If you&#8217;re happy doing that then you can write tasks like:</p>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="example" basedir="."&gt;
&lt;property name="username" value="{user}"/&gt;
&lt;property name="password" value="{password}"/&gt;
&lt;target name="backup-apacheconf" description="backup apache2.conf file from a remote server"&gt;
    &lt;scp file="${username}@${host}:/etc/apache2/apache2.conf" todir="." password="${password}"/&gt;
&lt;/target&gt;
&lt;/project&gt;</pre></div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/11/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/9/">Newer &rarr;</a>
    
  </div>
</div>

    </div>
  </div>
  <footer role="contentinfo">
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'morethanseven';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
