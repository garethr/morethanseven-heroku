
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Morethanseven</title>
  <meta name="author" content="Gareth Rushgrove">

  
  <meta name="description" content="I&#8217;ve written before about why I like System Packages, but even I&#8217;ll admit that the barriers to creating them mean I don&#8217;t use them &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.morethanseven.net/page/4">
  <link href="/favicon.ico" rel="icon">
  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/articles.atom" rel="alternate" title="Morethanseven" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<meta content="etkmKMftqAyYJM6-DP_TTKJjV0EHM5vbVcaOloSo8Z8" name="google-site-verification">
<link href="http://www.myopenid.com/server" rel="openid.server">
<link href="http://garethr.myopenid.com/" rel="openid.delegate">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-435455-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header>
<hgroup>
<h1><a href="/">Morethanseven</a></h1>
<p>The blog of Gareth Rushgrove</p>

<div id='carbonads-container'>
  <div class='carbonad'>
    <div id='carbon'></div>
    <script type='text/javascript'>
      //<![CDATA[
        var z = document.createElement("script");
        z.type = "text/javascript";
        z.async = true;
        z.src = "http://engine.carbonads.com/z/12119/carbon_2_1_0_HORIZ";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(z, s);
      //]]>
    </script>
  </div>
</div>

</hgroup>
</header>


  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/29/Creating-a-cucumber-nagios-package-with-fpm/">Creating a Cucumber Nagios Package With Fpm</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-29T00:00:00+01:00" pubdate data-updated="true">Apr 29<span>th</span>, 2011</time>
        
         | <a href="/2011/04/29/Creating-a-cucumber-nagios-package-with-fpm/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve written <a href="http://morethanseven.net/2011/01/16/Why-developers-should-care-about-system-packages.html">before</a> about why I like System Packages, but even I&#8217;ll admit that the barriers to creating them mean I don&#8217;t use them for everything. <a href="https://github.com/jordansissel/fpm"><span class="caps">FPM</span></a> however is making it much easier, to the point where I&#8217;m starting to create a few packages I can reuse on projects. I thought a write up of how I&#8217;m doing that for <a href="http://cucumber-nagios.org/">Cucumber-Nagios</a> might be useful.</p>
<p>For those that haven&#8217;t seen it yet, <span class="caps">FPM</span> (or Effing Package Management) is a tool that helps you build packages, like RPMs and DEBs, quickly. It can take in gems, python packages, node.js npm files or just plain directories and make files and from that create you one or more system packages. Lets have a look at a full example with a Ruby gem.I really like using cucumber-nagios, whatever platform or language I happen to be using at the time. I have a number of Django projects for instance with cucumber-nagios checks, so being able to not worry about most of the Ruby install is useful.</p>
<p>In order to use <span class="caps">FPM</span> you&#8217;ll need to install it. It&#8217;s available as a Ruby gem so lets start there. I&#8217;m not going to delve into setting up a Ruby Gems environment as it&#8217;s annoying and covered for most platforms elsehere on the internet.</p>
<pre><code>gem install fpm</code></pre>
<p>First off lets install the cucumber-nagios gem, along with all it&#8217;s dependencies, into a local folder on my build machine. This might be a virtual machine or a separate machine in your cluster. It should be running the same OS as the intended production machines however. The following examples are from Ubuntu, but it&#8217;s much the same for <span class="caps">RPM</span> based distros.</p>
<pre><code>gem install --no-ri --no-rdoc --install-dir ~/tmp/gems cucumber-nagios</code></pre>
<p>Cucumber-nagios has a large number of dependencies, so we&#8217;re going to need to create packages for all of those too. <span class="caps">FPM</span> will cleverly deal with maintaining the specified dependencies thought. We&#8217;ll use find to do this quickly, and then instruct <span class="caps">FPM</span> to convert from a gem to a deb. You could obviously do this line by line if you prefer.</p>
<pre><code>find ~/tmp/gems/cache -name '*.gem' | xargs -rn1 fpm -s gem -t deb -a all</code></pre>
<p>That should leave us with lots of new .deb files that we can have a closer look at:</p>
<pre><code>dpkg --info rubygem-cucumber-nagios_0.9.0_i686.deb
dpkg -c rubygem-cucumber-nagios_0.9.0_i686.deb</code></pre>
<p>If you already have a private apt repository set up then just upload these packages and away you go. I&#8217;d like to use apt for installing them so I can leave it to manage all the dependencies easily. If not then I&#8217;ll show you briefly how to create a local file system repo, it&#8217;s not much more work to create a shared repo available over <span class="caps">HTTP</span>.</p>
<p>First create a directory to store our packages and move our newly created .deb files into it. You&#8217;ll need to be able to execute some of these commands as root but given the topic I&#8217;m assuming you&#8217;ll be able to deal with that.</p>
<pre><code>mkdir /usr/local/repo
cp *.all.deb /usr/local/repo</code></pre>
<p>For the next part you&#8217;ll need to install the dpkg development tools, and then create a file that can be read by apt when it&#8217;s looking for packages it can install.</p>
<pre><code>apt-get install dpkg-dev
dpkg-scanpackages /usr/local/repo /dev/null | gzip -9c &gt; /usr/local/repo/Packages.gz</code></pre>
<p>Now add your new package repo to your apt sources and update your package cache.</p>
<pre><code>/etc/apt/sources.list
deb file:/usr/local/repo ./
apt-get update</code></pre>
<p>At this point everything should be up and running. Let&#8217;s do a search in our repo:</p>
<pre><code>apt-cache search rubygem-
rubygem-amqp - AMQP client implementation in Ruby/EventMachine
rubygem-builder - Builders for MarkUp.
rubygem-bundler - The best way to manage your application's dependencies
rubygem-cucumber - cucumber-0.10.2
rubygem-cucumber-nagios - Systems testing plugin for Nagios using Cucumber.
rubygem-diff-lcs - Provides a list of changes that represent the difference between two sequenced collections.
rubygem-eventmachine - Ruby/EventMachine library
rubygem-extlib - Support library for DataMapper and Merb
rubygem-gherkin - gherkin-2.3.6
rubygem-highline - HighLine is a high-level command-line IO library.
rubygem-json - JSON Implementation for Ruby
rubygem-mechanize - The Mechanize library is used for automating interaction with websites
rubygem-net-ssh - Net::SSH: a pure-Ruby implementation of the SSH2 client protocol.
rubygem-nokogiri - Nokogiri (é‹¸) is an HTML, XML, SAX, and Reader parser
rubygem-rack - a modular Ruby webserver interface
rubygem-rack-test - Simple testing API built on Rack
rubygem-rspec - rspec-2.5.0
rubygem-rspec-core - rspec-core-2.5.1
rubygem-rspec-expectations - rspec-expectations-2.5.0
rubygem-rspec-mocks - rspec-mocks-2.5.0
rubygem-templater - Templater has the ability to both copy files from A to B and also to render templates using ERB
rubygem-term-ansicolor - Ruby library that colors strings using ANSI escape sequences
rubygem-webrat - Ruby Acceptance Testing for Web applications</code></pre>
<p>And finally lets install cucumber-nagios from our shiny new package.</p>
<pre><code>apt-get install rubygem-cucumber-nagios</code></pre>
<p>If everything has worked out you should be able to run the cucumber-nagios-gen command to create a new project. Note that the path may be different, and in the case of debian based distros the gem bin path is not on the Path.</p>
<pre><code>/usr/lib/ruby/gems/1.8/bin/cucumber-nagios-gen project test
Generating with project generator:
     [ADDED]  .gitignore
     [ADDED]  .bzrignore
     [ADDED]  Gemfile
     [ADDED]  README
     [ADDED]  features/steps
     [ADDED]  features/support</code></pre></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/17/Devops-weekly-archive/">Devops Weekly Archive</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-17T00:00:00+01:00" pubdate data-updated="true">Apr 17<span>th</span>, 2011</time>
        
         | <a href="/2011/04/17/Devops-weekly-archive/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since I launched it back in November my <a href="http://devopsweekly.com">Devops Weekly</a> email has been pretty well received I think. Folks on twitter seem to like it, as do a few people I&#8217;ve met at recent events who have said nice things. One thing a few people have been after though is an online archive, either because email just doesn&#8217;t work for them or more often because they missed out on the earlier issues.</p>
<p>With a little time this weekend and the help of <a href="https://github.com/mojombo/jekyll">Jekyll</a> I&#8217;ve just added the seventeen issÂ§ues to date to the new <a href="http://devopsweekly.com/archive">Devops Weekly archive</a>. I&#8217;d have liked to do something a bit more useful, maybe introduce per link tags or a nifty search feature, but I&#8217;m pretty busy at present and reason this should serve the main purpose of getting these links online.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/02/Vagrant-at-the-guardian/">Vagrant at the Guardian</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-02T00:00:00+01:00" pubdate data-updated="true">Apr 2<span>nd</span>, 2011</time>
        
         | <a href="/2011/04/02/Vagrant-at-the-guardian/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As recent blog posts on here make clear, I&#8217;m a big fan of <a href="http://vagrantup.com">Vagrant</a>. And when <a href="http://www.brunton-spall.co.uk/">Michael</a> asked if I&#8217;d fancy talking to some of his colleagues at The Guardian about how I use it I really couldn&#8217;t say no.</p>
<p>I gave a short talk, running through the following slides, and running a few demos showing creating, destroying and provisioning new machines.</p>
<p><object id="__sse7492432" width="595" height="497"> <param name="movie" value="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=vagrant-110402104037-phpapp01&rel=0&stripped_title=vagrant-and-configuration-management&userName=garethr" /> <param name="allowFullScreen" value="true"/> <param name="allowScriptAccess" value="always"/> <embed name="__sse7492432" src="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=vagrant-110402104037-phpapp01&rel=0&stripped_title=vagrant-and-configuration-management&userName=garethr" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="595" height="497"></embed> </object></p>
<p>More interesting I thought were the questions and conversations that followed. We talked a little about how Vagrant might fit into a continuous integration setup. Another aspect some of the systems folk took to was how flexible the network configuration was and whether they might be able to use this to more effectively test firewall configurations well before the final push into a production environment. It&#8217;s not something I&#8217;ve been doing but it sounds feasable and useful in some organisations. If anyone is doing interesting things with Vagrants network config I&#8217;d be interested to know.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/02/Collecting-metrics-with-ganglia-and-friends/">Collecting Metrics With Ganglia and Friends</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-02T00:00:00+01:00" pubdate data-updated="true">Apr 2<span>nd</span>, 2011</time>
        
         | <a href="/2011/04/02/Collecting-metrics-with-ganglia-and-friends/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had the pleasure of speaking at <a href="http://cambridgegeeknights.net/">Cambridge Geek Night</a> on Monday again, the topic of conversation being using Ganglia to collect more than just base systems metrics.</p>
<p><object id="__sse7492405" width="595" height="497"> <param name="movie" value="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=metricswithganglia-110402103441-phpapp01&rel=0&stripped_title=metrics-with-ganglia&userName=garethr" /> <param name="allowFullScreen" value="true"/> <param name="allowScriptAccess" value="always"/> <embed name="__sse7492405" src="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=metricswithganglia-110402103441-phpapp01&rel=0&stripped_title=metrics-with-ganglia&userName=garethr" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="595" height="497"></embed> </object></p>
<p>The audience of web developers, the odd sysadmin and business folk seemed to enjoy it and we had lots of time for questions at the end. The main point I tried to get across was that Ganglia makes a great platform for ad-hoc metrics gathering due to the ability to just throw values at it and get time series graphs without any extra configuration.</p>
<p>The slides include a few bits of code I&#8217;ve been using that I&#8217;ll throw onto GitHub as a proper project when I get the time. These are very simple Python servers, one which allows for sending metrics information over <span class="caps">HTTP</span>, the other using <span class="caps">TCP</span> instead. Both really handy for getting more people to add hooks into applications.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/26/Devops-isnt-a-methodology/">Devops Isn&#8217;t a Methodology</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-26T00:00:00+00:00" pubdate data-updated="true">Mar 26<span>th</span>, 2011</time>
        
         | <a href="/2011/03/26/Devops-isnt-a-methodology/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I was reading <a href="http://teddziuba.com/2011/03/devops-scam.html">Devops is a poorly executed scam</a> and just couldn&#8217;t resist a reply. Not because of the entertaining title, but because I both agree and disagree quite strongly with parts of the post. Read it first if you haven&#8217;t already. And yes I know I&#8217;m feeding the internet.</p>
<p>I&#8217;m going to pick parts of the post out and then comment. Hopefully I&#8217;m not quoting these in any way out of context.</p>
<h2>&#8220;It&#8217;s got the potential to make a handful of people a lot of money in the same way that Agile did, but nobody is really executing on.&#8221;</h2>
<p>People are pretty aware of this fact I think, but watch what happens when people post on the mailing lists or turn up at community events with a purely marketing hat on. They just get no traction and even damage their product brand amongst the early adopters. The fact the term is starting to get used in job adverts and marketing materials isn&#8217;t really being driven by the people talking about what devops might or might not be. I think the main reason for this is that most of the people I talk to in person or online are actually pretty happy with their jobs and generally work inside companies rather than as independent consultants. They have often reached an age where they want to improve within a given field but would like a wider network than their current colleagues to discuss things with.</p>
<h2>&#8220;How do you implement Devops?&#8221;</h2>
<p>I don&#8217;t think you do. The comparisons with Agile are interesting from a community point of view but Scrum is a methodology. To me at least devops isn&#8217;t, it&#8217;s just a banner or tag under which interesting conversations are happening. The argument that &#8220;You should be doing this anyway. Not earth shattering.&#8221; is a good thing. You&#8217;d be suprised by how many people don&#8217;t do all the things they should be doing, especially in small and young companies. And one of the reasons for that is no one bothered writing a list of these things down anywhere and then discussing them. I&#8217;m not saying this huge list exists or even whether it should, but the discussion is happening.</p>
<h2>&#8220;The underlying problem, however, is that dev and ops have different goals&#8221;</h2>
<p>This is spot on. I think this maybe does get missed in talk that focuses more on tools but not in the wider discussion happening about business improvements. Devops quite litterally brings those two things together. You&#8217;ll always have individual goals but where you have separate operations and development teams they should have the same fundamental goals.</p>
<h2>&#8220;Developers develop in the same environment production runs in If you deploy to Linux, you develop on Linux. No more of this coding on your Macbook Pro and deploying to Ubuntu: that is why you can&#8217;t have nice things.&#8221;</h2>
<p>Yes, yes and yes again. I&#8217;m definitely from the developer side of the tracks and I&#8217;m constantly telling people this and it&#8217;s definitely something I don&#8217;t see enough people doing. What I&#8217;d love is for all the operations people to state this to their development team and most importantly to help them set that up. Just saying <em>work like me or I won&#8217;t let you near the production machines</em> is just being obstructive. Educating and helping with tooling helps build those bridges and trust. And with trust comes the access the developers want. And less stupid bugs and less deployment issues with differing package dependencies.</p>
<h2>&#8220;None of this amounts to a methodology, as the Devops people would have you believe.&#8221;</h2>
<p>Still unsure which Devops people are saying it&#8217;s a bonefide methodology. I see the word used sometimes but generally in passing and not I don&#8217;t think meant how you mean here. And I don&#8217;t think I&#8217;ve heard people speak about it in person. &#8220;Scrum methodology&#8221; returns more than 113,000 results in Google. &#8220;Devops methodology&#8221; returns about 150, some of which 404 and half of which are agregators pointing at the other half.</p>
<h2>&#8220;The Devops movement smells of a scam in the making&#8221;</h2>
<p>Some company or other is definitely going to be scammed into paying over the odds for a consultant because they used the word Devops in the sales pitch. That will have next to nothing to do with what I&#8217;d see as the Devops movement and everything to do with human nature (and sales people).</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/20/A-continuous-deployment-example-setup/">A Continuous Deployment Example Setup</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-20T00:00:00+00:00" pubdate data-updated="true">Mar 20<span>th</span>, 2011</time>
        
         | <a href="/2011/03/20/A-continuous-deployment-example-setup/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the reasons behind getting around to building <a href="http://www.vagrantbox.es">Vagrantbox.es</a> recently was I was giving a talk to a group of startups on <a href="http://thedifferenceengine.eu/">The Difference Engine</a> programme and I wanted to have an example project to demonstrate various things. I wanted to demonstrate everything from sensible version control habbits, configuration management, basic orcestration and most importantly a solid deployment process. I&#8217;ve decided to write up what I&#8217;m doing for deployment because I think it&#8217;s pretty nice, and for all the talk about Continuous Deployment I haven&#8217;t seen many examples of code and configuration to make it happen.</p>
<p>Most of what I&#8217;ll cover is pretty easy to map to whatever technologies your using. For this project I&#8217;d gone for Git, Django, Gunicorn, Nginx, Fabric, Mysql and Jenkins and I&#8217;m deploying to Ubuntu running on <a href="http://www.brightbox.co.uk/">Brightbox Cloud</a>. Apart from the Jenkins instance in the middle you could follow the instructions and swap things out easily.</p>
<h2>Jenkins</h2>
<p>First up lets install <a href="http://jenkins-ci.org/">Jenkins</a>. I setup a separate cloud instance just to run the Continuous Integration server. I find this approach easier to manage but you could always run this locally if you prefer. The Jenkins folk provide very up to date <a href="http://pkg.jenkins-ci.org/debian/">packages for Debian</a> so I chose to use those.</p>
<h3>Plugins</h3>
<p>Jenkins provides a huge number of optional plugins which enable various additional features. Plugins are installed via the web interface at /pluginManager. I&#8217;ve installed:</p>
<ul>
	<li><a href="http://wiki.jenkins-ci.org/display/JENKINS/Cobertura+Plugin">Jenkins Cobertura Plugin</a></li>
	<li><a href="http://wiki.jenkins-ci.org/display/JENKINS/Git+Plugin">Jenkins <span class="caps">GIT</span> plugin</a></li>
	<li><a href="http://wiki.jenkins-ci.org/display/JENKINS/Github+Plugin">GitHub plugin</a></li>
	<li><a href="http://wiki.hudson-ci.org/display/HUDSON/Green+Balls">Green Balls</a></li>
	<li><a href="http://wiki.hudson-ci.org/display/HUDSON/Violations">Hudson Violations plugin</a></li>
</ul>
<p>Only the Git plugin is really required for what I&#8217;m doing with deployment. Cobertura and Violations are code quality metrics tools that I use to record output from pylint and code coverage for my test suite.</p>
<h2>The Source</h2>
<p>My finished project was already on GitHub in a private repository. I&#8217;m using a requirements.txt file to record python dependencies so I can use pip to install them automatically and I&#8217;m using Virtualenv to sandbox this installation. I&#8217;m also using South to manage my database schema changes. I won&#8217;t go into that here as it&#8217;s pretty Python specific, Rails for instance has Active Record migrations, <span class="caps">RVM</span> and Bundler which do pretty much the same job. <span class="caps">PHP</span> has <span class="caps">PEAR</span> and some of the frameworks offer a migration tool.</p>
<p>I then created two projects in Jenkins:</p>
<p><img src="http://image-host.appspot.com/i/img?id=agppbWFnZS1ob3N0cg0LEgVJbWFnZRiRywEM" alt="Jenkins dashboard"/></p>
<h3>Project 1: Vagrantboxes</h3>
<p>This is the main build of my master branch in Git. As well as setting up the Git repo as shown below I&#8217;ve set a polling schedule to */5 * * * * (that&#8217;s every 5 minutes) and also set Trigger builds remotely so I can have a task in my fabfile which triggers a build immediately.</p>
<p><img src="http://image-host.appspot.com/i/img?id=agppbWFnZS1ob3N0cg0LEgVJbWFnZRjh2gEM" alt="Git config for Jenkins"/></p>
<p>I then have two build steps, both of which execute shell commands. The first installs any new requirements via pip:</p>
<pre>bash -l -c "source bin/activate; pip install -r requirements.txt"</pre>
<p>The second runs my test suite and generates the <span class="caps">XML</span> output required to show the test results in Jenkins:</p>
<pre>bash -l -c "source bin/activate; cd vagrantboxes/configs/common; python manage.py jenkins boxes"</pre>
<p>I&#8217;m using the rather handy <a href="https://github.com/kmmbvnr/django-jenkins">Django Jenkins</a> application for this.</p>
<p>So far so good. This gives us a project that, when we push some changes to GitHub, will pull those changes down to the CI server and run our test suite, giving us feedback as to whether the tests pass or fail.</p>
<p>Now for the trick, in Post-build Actions tick Build other projects and specify the name of another project that we&#8217;ll setup next. Mine is called Vagrantboxes-deploy.</p>
<p><img src="http://image-host.appspot.com/i/img?id=agppbWFnZS1ob3N0cg0LEgVJbWFnZRirwwEM" alt="Post build action in Jenkins"/></p>
<h3>Project 2: Vagrantboxes-deploy</h3>
<p>This project is triggered only when the previous project runs successfully. And all it&#8217;s going to do is run the deployment script on the project we just built. The setup for this project is very simply, it has one build step which just executes the following:</p>
<pre>bash -l -c "cd /var/lib/jenkins/jobs/Vagrantboxes/workspace; source bin/activate; fab appserver deploy"</pre>
<p>The specifics of the Fabric script here aren&#8217;t that important but I&#8217;m doing something not too disimilar to <a href="http://morethanseven.net/2009/07/27/fabric-django-git-apache-mod_wsgi-virtualenv-and-p.html">what I described here</a>.</p>
<p>The reason I&#8217;ve setup a separate project for these is so I can, if I choose, trigger a deployment separately to the full build, and also so I can very easily disable deployments even if the main build is still running.</p>
<h2>Conclusions</h2>
<p>With this setup whenever I push code to master it triggers a build. If the test suite passes it runs the deployment script and pushes out the code to the live web servers. This suites me and this project but you might find it easier to start by pushing all successfull builds out to a staging environment. And maybe then moving on to having a new project which is only triggered manually for deploying to production.</p>
<p><img src="http://image-host.appspot.com/i/img?id=agppbWFnZS1ob3N0cg0LEgVJbWFnZRiqwwEM" alt="project view in Jenkins"/></p>
<p>This setup has other advantages too. The Jenkins dashboard becomes a handy tool for recording deployment events. You can easily setup emails or IM messages or Campfire posts to alert other team members whenever a deployment happens. And it really really makes sure your delployment scripts work without hand holding.</p>
<p>This is a simple project that I&#8217;m working on on my own, but in a team environment you&#8217;d likely have a more complex branching strategy and more Jenkins projects. You might also introduce some gateways for manual testing but the starting point is the same. Jenkins makes archiving successful build artifacts relatively easy as well, this setup has a few race condition possibilities that you can fix by building artifacts from successful builds. Jenkins also supports building from different branches and having different branches trigger different projects, all handy if you want to grow this kind of setup.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/12/Site-for-vagrant-base-boxes/">Site for Vagrant Base Boxes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-12T00:00:00+00:00" pubdate data-updated="true">Mar 12<span>th</span>, 2011</time>
        
         | <a href="/2011/03/12/Site-for-vagrant-base-boxes/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A brief <a href="https://twitter.com/#!/garethr/status/40785392445685760">conversation with Matt Keating</a> on Twitter finally pushed me over the edge and I&#8217;ve built a site I&#8217;d been meaning to do for a while.</p>
<p>I&#8217;m a huge <a href="http://vagrantup.com">Vagrant</a> fan, but one thing that often comes up is where to find base boxes. My newly launched site <a href="http://vagrantbox.es">Vagranbox.es</a> provides just that. At the moment that just means user submitted boxes being checked and then posted. I&#8217;ll likely add comments and ratings and the like if things become popular but that&#8217;s for later.</p>
<p><img src="http://image-host.appspot.com/i/img?id=agppbWFnZS1ob3N0cg0LEgVJbWFnZRjBuwEM" alt="vargrantbox.es homepage"/></p>
<p>So, if you know of or host a useful box please let me know. I&#8217;ll try to keep up with any submissions.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/02/Devops-more-than-marketing-talk-by-james-turnbull/">Devops - More Than Marketing - Talk by James Turnbull</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-02T00:00:00+00:00" pubdate data-updated="true">Mar 2<span>nd</span>, 2011</time>
        
         | <a href="/2011/03/02/Devops-more-than-marketing-talk-by-james-turnbull/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve just found my notes from <a href="http://kartar.net">James Turnbull&#8217;s</a> talk at <a href="http://fosdem.org"><span class="caps">FOSDEM</span></a>. I found the talk excellent, and I&#8217;m already part of the choir. But much of the audience I&#8217;d guess have only come across the devops term in passing, or worse had it pushed at them as part of marketing materials. Hopefully I captured the main points:</p>
<h2>So what is devops all about?</h2>
<ul>
	<li>Cooperation (between development and operations teams)</li>
	<li>Buzzword bingo?</li>
	<li>Pop culture movement?</li>
	<li>Discussion</li>
	<li>It&#8217;s early days</li>
	<li>No one has all the answers</li>
	<li>Nothing is fixed in stone</li>
	<li>It&#8217;s all about outreach</li>
</ul>
<h2>It&#8217;s about</h2>
<ul>
	<li>Simplicity &#8211; Repeatable, Reusable, Easy to communicate</li>
	<li>Relationships &#8211; Engage early, engage often, &#8220;Toss it over the fence&#8221;, Talk to people</li>
	<li>Process &#8211; Test everything, Automate everything, Redundancy and expectation of failure, Transparent and open to everyone</li>
</ul>
<h2>Tools</h2>
<ul>
	<li>Not just ops tools &#8211; Config mnagement, Deployment and orchestration, Monitoring, Security, Testing</li>
	<li>Use for entire lifecycle dev &#8594; test &#8594; ops</li>
	<li>Not just dev tools &#8211; Version control, Agile, Application architecture</li>
	<li>Testing methodology &#8211; Low level vs functional</li>
	<li>Documentation &#8211; &#8220;The only time the network diagram is up to date is after the post mortem&#8221;</li>
</ul>
<h2>Continuous improvement</h2>
<ul>
	<li>Nothing stands still &#8211; Customers, Products, Technology, Your team</li>
	<li>Strike often, striek hard, be aggressive</li>
</ul>
<h2>It&#8217;s a culture change</h2>
<ul>
	<li>This is Hard</li>
	<li>People hate change</li>
	<li>People hate people who introduce change</li>
	<li>Fear of change is irrational &#8211; Listen, Concrete examples</li>
	<li>Make developers resonsible for uptime &#8211; Pagers</li>
</ul>
<h2><span class="caps">FUD</span></h2>
<ul>
	<li>&#8220;We&#8217;ve always done this&#8221;</li>
	<li>&#8220;That can&#8217;t work here&#8221;</li>
	<li>&#8220;This is all about one group or another&#8221;</li>
	<li>&#8220;You&#8217;re an elitist bunch of Europeans&#8221;</li>
</ul>
<h2>Dangers</h2>
<ul>
	<li>Marketing speak</li>
	<li>Lip service</li>
	<li>Disenchantment</li>
	<li>Disenfranchisement</li>
</ul>
<h2>Takeaway</h2>
<ul>
	<li>&#8220;Not about a person, or a team. About changing how your operations team works&#8221;</li>
	<li>Automate away small boring repetative tasks to make time for interesting activities</li>
	<li>Embed ops people into dev teams</li>
	<li>Drag devs to ops standups</li>
	<li>Build shared appreciation</li>
	<li>Metrics conversations are really powerful</li>
</ul></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/02/08/Configuration-management-for-development-environments/">Configuration Management for Development Environments</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-08T00:00:00+00:00" pubdate data-updated="true">Feb 8<span>th</span>, 2011</time>
        
         | <a href="/2011/02/08/Configuration-management-for-development-environments/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had the pleasure of speaking at <a href="http://www.fosdem.org/2011/">Fosdem</a> last weekend to a packed <a href="http://www.fosdem.org/2011/schedule/track/configuration_systems_management_devroom">Configuration amd systems management devroom</a>.</p>
<p>My presentation covered some of the same ground as recent blog posts, namely why you should be using virtualisation and config management tools to manage your local development environment.</p>
<p><object id="__sse6836888" width="425" height="355"><param name="movie" value="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=configmanagamentfordevelopmentenvironments-110207033122-phpapp02&stripped_title=config-managament-for-development-environments-6836888&userName=garethr" /><param name="allowFullScreen" value="true"/><param name="allowScriptAccess" value="always"/><embed name="__sse6836888" src="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=configmanagamentfordevelopmentenvironments-110207033122-phpapp02&stripped_title=config-managament-for-development-environments-6836888&userName=garethr" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="355"></embed></object></p>
<p>People even said <a href="http://twitter.com/#!/unixdaemon/status/34209307390124033">nice things</a> about it:</p>
<blockquote>
<p>@garethr basically has this subject completely covered. He&#8217;s even advocating the correct editor. excellent #fosdem talk</p>
</blockquote>
<p>All in all another good event, I have notes about some of the other talks I went along to that I&#8217;ll try write up soon.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/29/Using-checkinstall-with-virtualenv-for-python-deployments/">Using Checkinstall With Virtualenv for Python Deployments</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-29T00:00:00+00:00" pubdate data-updated="true">Jan 29<span>th</span>, 2011</time>
        
         | <a href="/2011/01/29/Using-checkinstall-with-virtualenv-for-python-deployments/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Michael Brunton-Spall wrote last week about some <a href="http://www.brunton-spall.co.uk/post/2011/01/26/packaging-and-deploying-python-web-apps/">frustrations with packagings and deploying Python web applications</a>. Although his experience was with Python, the problems he describes are the same for Ruby and <span class="caps">PHP</span> and a whole host of languages. The following example uses Python, but works equally as well for anything else.</p>
<p>Michael has three simple rules for his servers:</p>
<ol>
	<li>they cannot access the internet</li>
	<li>they cannot access internal services that are for development</li>
	<li>they cannot have compilers / utilities on them</li>
</ol>
<p>I won&#8217;t go into all the reasons for doing this (you can read the blog post linked to above) but these are pretty sensible security precautions.</p>
<p>My approach to this problem would be to use your friendly system packages and using a handy tool called <a href="http://www.asic-linux.com.mx/~izto/checkinstall/">Checkinstall</a> to create a deb or rpm. I&#8217;m going to use as an example the <a href="http://wiki.secondlife.com/wiki/Eventlet">Eventlet</a> library. This is available in PyPi and one of it&#8217;s dependencies (Greenlets) provides a C extension. The same approach would work for an entire Python web application too. I&#8217;m as ever using the apt package management tool but this should work with yum as well.</p>
<p>The first step is to build the package on a build machine. This should be a machine or virtual machine running the same operating system as your production web servers. You might build these packages manually or as part of a continuous integration system. On this machine we&#8217;ll need the compilers and development tools:</p>
<pre>sudo apt-get install build-essential python-dev python-setuptools checkinstall
sudo easy_install virtualenv</pre>
<p>We&#8217;ll also create a virtualenv into which we&#8217;ll be installing our packages:</p>
<pre>sudo virtualenv --no-site-packages /usr/local/environment
source /usr/local/environment/bin/activate</pre>
<p>Now, instead of just calling easy_install to install the package, we prefix it with checkinstall.</p>
<pre>sudo checkinstall /usr/local/environment/bin/easy_install eventlet</pre>
<p>This will prompt for various meta data about the package you want to create, including the name and version of the package. If you&#8217;re using this method in the real world you&#8217;ll want to decide on a versioning and naming scheme for your packages to avoid clashes with system provided packages. You can also set many of these options from the command line rather than having to manually fill them in each time.</p>
<p>Once everything has been filled in successfully this should run through, installing eventlet and greenlets and eventually creating a deb or rpm package depending on what platform you&#8217;re running on. You should see something like:</p>
<pre>Done. The new package has been installed and saved to

 /home/vagrant/eventlet-gareth_20110129-1_i386.deb

 You can remove it from your system anytime using: 

      dpkg -r eventlet-gareth</pre>
<p>Now lets grab that package and take it to one of our front end web servers via a controlled deployment process. That front end web server needs the virtualenv creating but nothing else. So:</p>
<pre>sudo apt-get install python-virtualenv
sudo virtualenv --no-site-packages /usr/local/environment</pre>
<p>(Now you might be thinking that installing the python-virtualenv package in this way breaks rule 1 above. And you&#8217;d be right in most cases, but I&#8217;m guessing Michael&#8217;s systems team have a local package repo for authorised packages, or alternatively you could download the package to the build machine and push it to the production environment.)</p>
<p>Now install the package we created earlier.</p>
<pre>sudo dpkg -i eventlet-gareth_20110129-1_i386.deb</pre>
<p>That should throw all the required files into the virtualenv environment we created. No compilers. No calls to internal or external systems. Just move some precompiled binaries and text files to predefined places on disk.</p>
<p>I used a PyPi package as an example. Checkinstall could have been pointed at a custom build file written especially for your own application, one that moves files and folders to where they are needed. Say something that looks like this:</p>
<pre>#!/bin/sh
cp /home/stage/myapplication /var/www/apps/</pre>
<p>The running checkinstall against that (or a more complex build file using capistrano or ant or fabric) you can create a package containing your application code and install it into the specified place.</p></div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/5/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/3/">Newer &rarr;</a>
    
  </div>
</div>

    </div>
  </div>
  <footer role="contentinfo">
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'morethanseven';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
