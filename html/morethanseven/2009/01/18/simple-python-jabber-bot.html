<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <title>A Simple Python Jabber Bot</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type' />
    <meta content='lastfm, xmpp, python, apis' name='keywords' />
    <meta content='etkmKMftqAyYJM6-DP_TTKJjV0EHM5vbVcaOloSo8Z8' name='google-site-verification' />
    <link href='/assets/css/reset.css' rel='stylesheet' type='text/css' />
    <link href='/assets/css/style.css' media='screen' rel='stylesheet' type='text/css' />
    <link href='/assets/css/code.css' rel='stylesheet' type='text/css' />
    <link href='http://www.myopenid.com/server' rel='openid.server' />
    <link href='http://garethr.myopenid.com/' rel='openid.delegate' />
    <link href='/articles.atom' rel='alternate' title='Morethanseven Atom Feed' type='application/atom+xml' />
  </head>
  <body>
    <div id='main'>
      <div id='header'>
        <div class='logo'>
          <a href='/'>&laquo; morethanseven</a>
        </div>
        <div id='carbonads-container'>
          <div class='carbonad'>
            <div id='carbon'></div>
            <script type='text/javascript'>
              //<![CDATA[
                var z = document.createElement("script");
                z.type = "text/javascript";
                z.async = true;
                z.src = "http://engine.carbonads.com/z/12119/carbon_2_1_0_HORIZ";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(z, s);
              //]]>
            </script>
          </div>
        </div>
        <div id='nav'>
          <ul>
            <li><a href='/about.html'>about</a></li>
            <li><a href='/archives.html'>archives</a></li>
            <li><a href='/tags.html'>tags</a></li>
            <li>
              <a href='/articles.atom'>rss</a>
            </li>
          </ul>
        </div>
      </div>
      <div class='clear'></div>
      <div class='article'>
        <h1>
          A Simple Python Jabber Bot
        </h1>
        <div class='meta'>
          <ul class='tags'>
            <li>Jan 18, 2009</li>
            <li>
              &middot;
            </li>
            <li>
              <a href='/2009/01/18/simple-python-jabber-bot.html#disqus_thread'></a>
            </li>
            <li>&middot;</li>
            <li>
              <a class='tag' href='/tags/apis/'>
                apis
              </a>
            </li>
            <li>
              <a class='tag' href='/tags/lastfm/'>
                lastfm
              </a>
            </li>
            <li>
              <a class='tag' href='/tags/python/'>
                python
              </a>
            </li>
            <li>
              <a class='tag' href='/tags/xmpp/'>
                xmpp
              </a>
            </li>
          </ul>
        </div>
        <div class='body'>
          <p>I&#8217;ve been knocking together various little instant messaging bots recently, partly as a way to play around with <span class="caps">XMPP</span>. As well as using the low level <a href="http://xmpppy.sourceforge.net/">xmppy</a> and <a href="http://code.google.com/p/xmpp4r-simple/">XMPP4R-Simple</a> libraries I&#8217;ve been having lots of fun with the <a href="http://thpinfo.com/2007/python-jabberbot/">JabberBot</a> framework.</p>
          <p>Jabberbot lets you write simple bots incredibly quickly, using simple conventions to determine what commands the bot exposes. It&#8217;s easier to explain with a simple example. The following bot lets you send the command <em>time</em> to it and returns the current time on the server on which the bot is running. The magic is in the name of the method <em>bot_time_. Any methods that start bot</em> are automatically exposed as commands for the bot to accept.</p>
          <p>You&#8217;ll need an xmpp server for the bot to connect to but you could always just register an additional google account and use it over gtalk if you wanted to. Personally I&#8217;m running <a href="http://www.ejabberd.im">ejabberd</a> on a local Ubuntu VM as well for testing.</p>
          <pre>from jabberbot import JabberBot&#x000A;import datetime&#x000A;class SystemInfoJabberBot(JabberBot):&#x000A;    def bot_time( self, mess, args):&#x000A;        """Displays current server time"""&#x000A;        return str(datetime.datetime.now())&#x000A;username = 'my-jabberid@jabberserver.example.org'&#x000A;password = 'my-password'&#x000A;bot = SystemInfoJabberBot(username,password)&#x000A;bot.serve_forever()</pre>
          <p>The JabberBot site has a few more examples as well with fancier features. At the recent Last.fm hackday I spent a bit of time knocking together a bot which talks to the Last.fm <span class="caps">API</span> (using the <a href="http://code.google.com/p/pylast/">PyLast</a> library for the <span class="caps">API</span> backwards and forwards.) I did this mainly as a demonstration of how simple it can be to create a useful command line interface to your <span class="caps">API</span> using an instant messaging client.</p>
          <p>The code for <a href="http://github.com/garethr/lastbot/tree/master">LastBot</a> is on GitHub. It has a few limitations and doesn&#8217;t intent to cover anywhere near all the <span class="caps">API</span>. When up and running you should be able to talk to it with your IM client. Simply send the user specified in the settings file a message like so:</p>
          <pre>search {query}</pre>
          <p>So if you wanted to search for “astley” you would type:</p>
          <pre>search astley</pre>
          <p>Which would probably give you:</p>
          <pre>you probably mean Never Gonna Give You Up by Rick Astley&#x000A;http://www.last.fm/music/Rick_Astley/_/Never_Gonna_Give_You_Up&#x000A;Richard Paul Astley (born February 6, 1966) is an English dance-pop singer,&#x000A;songwriter and musician. He was born in Newton-le-Willows, St Helens,&#x000A;Lancashire, England. Astley currently resides in Richmond, Surrey with his &#x000A;Danish girlfriend, Lene Bausager, and their daughter, Emilie. In 1985, Astley &#x000A;was playing the club circuit as a singer with a soul band named FBI, when he &#x000A;was seen by the record producer Pete Waterman and persuaded to come to London &#x000A;to work at the PWL recording studio.</pre>
          <p>If the first result that comes back isn’t the one you wanted you can ask for the next result by simply sending next in another message. You can use prev as well to come back through the set.</p>
          <pre>next</pre>
          <p>You can always send it a call for help at any time which should return the instructions to you via an IM message.</p>
          <pre>help</pre>
          <p>Which should return something like:</p>
          <pre>Personal LastFM search bot. Useful for looking for tracks you can't &#x000A;remember the full name of. Or for findind out who sung a track.&#x000A;search: do a search for tracks&#x000A;prev: get details about the previous track in the list&#x000A;next: get details about the next track in the list</pre>
          <p>More instructions, and the code behind the bot, can be found in the <a href="http://github.com/garethr/lastbot/tree/master"><span class="caps">README</span></a>.</p>
          <p>As developers we spend a lot of time using command line interfaces &#8211; mainly for speed and because you can cram a lot of functionality into a small amount of screen real estate. We&#8217;re increasingly spending time debugging <span class="caps">API</span> calls as well and exposing your <span class="caps">API</span> calls for use by instant messaging clients has the potential to make development easier. Think of the Python interactive shell or of <span class="caps">IRB</span>, but for APIs.</p>
        </div>
      </div>
      <div id='other-articles'>
        <div class='older'>
          <ul>
            <li>
              <h3>
                <a href='/2009/01/15/are-xmpp-and-offline-processing-coming-google-app-.html' title=''>
                  &laquo; Are XMPP and offline processing coming to Google App Engine?
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2009/01/14/localbuilder-github.html' title=''>
                  &laquo; Localbuilder on GitHub
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2009/01/11/speaking-bamboo-juice.html' title=''>
                  &laquo; Speaking at Bamboo Juice
                </a>
              </h3>
            </li>
          </ul>
        </div>
        <div class='newer'>
          <ul>
            <li>
              <h3>
                <a href='/2009/01/20/django-testing-presentation-djugl.html' title=''>
                  Django Testing Presentation at DJUGL &raquo;
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2009/01/24/defence-apache-ant.html' title=''>
                  In Defence of Apache Ant &raquo;
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2009/01/28/git-issue-tracking.html' title=''>
                  Git Issue Tracking &raquo;
                </a>
              </h3>
            </li>
          </ul>
        </div>
      </div>
      <div class='clear'></div>
      <div class='comments'>
        <div id='disqus_thread'></div>
        <script src='http://disqus.com/forums/morethanseven/embed.js' type='text/javascript'></script>
        <noscript>
          <a href='http://disqus.com/forums/morethanseven/?url=ref'>
            View the discussion thread
          </a>
        </noscript>
      </div>
      <!-- / disqus adds too much visual crap -->
      <style type='text/css'>
        .dsq-dc-logo {
          display: none !important; }
      </style>
      <div class='clear'></div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        (function() {
          var links = document.getElementsByTagName('a');
          var query = '?';
          for(var i = 0; i < links.length; i++) {
            if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
            }
          }
          document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/morethanseven/get_num_replies.js' + query + '"></' + 'script>');
        })();
      //]]>
    </script>
    <script type='text/javascript'>
      //<![CDATA[
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      //]]>
    </script>
    <script type='text/javascript'>
      //<![CDATA[
        try {
          var pageTracker = _gat._getTracker("UA-435455-1");
          pageTracker._setDomainName(".morethanseven.net");
          pageTracker._setAllowHash(false);
          pageTracker._trackPageview();
          pageTracker._trackPageLoadTime();
        } catch(err) {}
      //]]>
    </script>
  </body>
</html>
