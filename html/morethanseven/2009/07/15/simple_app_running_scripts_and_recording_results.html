<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <title>Asteroid - simple app for running scripts and recording the results</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type' />
    <meta content='django, asteroid' name='keywords' />
    <link href='/assets/css/reset.css' rel='stylesheet' type='text/css' />
    <link href='/assets/css/style.css' media='screen' rel='stylesheet' type='text/css' />
    <link href='/assets/css/code.css' rel='stylesheet' type='text/css' />
  </head>
  <body>
    <div id='main'>
      <div id='header'>
        <div class='logo'>
          <a href='/'>&laquo; morethanseven</a>
        </div>
        <div id='nav'>
          <ul>
            <li><a href='/about.html'>about</a></li>
            <li><a href='/archives.html'>archives</a></li>
            <li><a href='/tags.html'>tags</a></li>
            <li>
              <a href='/atom.xml'>rss</a>
            </li>
          </ul>
        </div>
      </div>
      <div class='clear'></div>
      <div class='article'>
        <h1>
          Asteroid - simple app for running scripts and recording the results
        </h1>
        <div class='meta'>
          <ul class='tags'>
            <li>Jul 15, 2009</li>
            <li>&middot;</li>
            <li>
              <a class='tag' href='/tags/asteroid/'>
                asteroid
              </a>
            </li>
            <li>
              <a class='tag' href='/tags/django/'>
                django
              </a>
            </li>
          </ul>
        </div>
        <div class='body'>
          <p>Asteroid is a simple web interface for running scripts and recording the results. It&#8217;s like a much simpler and more general purpose version of something like Cruise Control. You can <a href="http://github.com/garethr/Asteroid/tree/master">get the code on Github</a>.</p>
          <p><img src="http://image-host.appspot.com/i/img?id=agppbWFnZS1ob3N0cgwLEgVJbWFnZRj5VQw" alt="Asteroid Dashboard"/></p>
          <p>I built it to solve two main problems:</p>
          <ul>
          	<li>It&#8217;s sometimes useful to have a historical record of a scripts execution, in particular whether it passed or failed and what the output was. Just running a command line script probably doesn&#8217;t give you that. It&#8217;s also useful to have a more graphical interface for those members of the team who don&#8217;t use the command line.</li>
          	<li>When working in a team you often want to run scripts against shared infrastructure, for instance deploying a testing release or running a test suite. Seeing what is running at present helps with that.</li>
          </ul>
          <p>So it should be useful for running deployments, running test suites, running backups, etc. It currently doesn&#8217;t have scheduling or similar build in, but as everything is triggered by hitting a <span class="caps">URL</span> it would be simple enough to use cron for something like that. It should also be useful whatever language you write your scripts in; rake, ant, shell scripts, etc. At the end of the day it just executes a command at the console.</p>
          <h2>Requirements</h2>
          <p>Asteroid uses the Django Python framework under the hood.</p>
          <ul>
          	<li>Django &#8211; <a href="http://www.djangoproject.com/">http://www.djangoproject.com/</a></li>
          </ul>
          <p>You&#8217;ll also need a database. The default in the shipped settings is to use sqlite but this should work with any database supported by Django.</p>
          <p>You&#8217;ll also need a decent web browser. I&#8217;ve gone and used HTML5 as an experiment and with this being a developer tool I&#8217;m hoping to stick with it. It would be easy enough to convert the templates if this is a problem however.</p>
          <p>The application has an optional message queue backend which can be enabled in the settings file. This is used to improve the responsiveness of the application as well as allow commands to be executed on a remote machine, rather than on the box Asteroid is running.</p>
          <ul>
          	<li>AMQPlib &#8211; <a href="http://barryp.org/software/py-amqplib/">http://barryp.org/software/py-amqplib/</a></li>
          	<li>RabbitMQ &#8211; <a href="http://www.rabbitmq.com/">http://www.rabbitmq.com/</a></li>
          </ul>
          <p>Other <span class="caps">AMQP</span> compliant message queues should work but it&#8217;s currently only tested with Rabbit.</p>
          <p>If you are intending to do any development on Asteroid, or just want to look more closely at the code, I&#8217;d recommend installing</p>
          <ul>
          	<li>Clue &#8211; <a href="http://github.com/garethr/django-clue/tree/master">http://github.com/garethr/django-clue/tree/master</a></li>
          	<li>Test Extensions &#8211; <a href="http://github.com/garethr/django-test-extensions/tree/master">http://github.com/garethr/django-test-extensions/tree/master</a></li>
          </ul>
          <h2>Usage Instructions</h2>
          <p>You should be able to just download asteroid and run it from wherever you put it, once you setup the database.</p>
          <pre>cd asteroid/configs/common&#x000A;manage.py syncdb&#x000A;manage.py runserver</pre>
          <p>This should bring the local web server up on port 8000 so visit http://localhost:8000 and see.</p>
          <p>If you&#8217;re using the message queue backend you&#8217;ll need to run the listener script in order to get your commands executed. At the moment that means modifying a constant in the listener script to point at a running message queue instance at asteroid/bin/asteroid_listen.py.</p>
          <pre>cd asteroid/bin&#x000A;./asteroid_listen.py</pre>
          <p>Once you&#8217;re up and running you should be able to add commands via the admin interface at http://localhost:8000/admin/. The username and password should be those you added when creating the database via the syncdb command above.</p>
          <p>The development configs include a few additional applications (mentioned above) which I use for testing and debugging. You can run the test suite like so:</p>
          <pre>cd asteroid/configs/development&#x000A;manage.py test --coverage</pre>
          <h2>Todo</h2>
          <p>This is an early release that just about <em>works for me</em>. I can already see a number of areas I&#8217;d like to clean up a little or extend. For instance:</p>
          <ul>
          	<li>Other deployment options, including a <span class="caps">WSGI</span> file and a spawning startup script.</li>
          	<li>Use a database migration system to make upgrades easier.</li>
          	<li>Make the message queue listener script more robust.</li>
          	<li>Make the command entry more robust, it sometimes takes a bit of fiddling with to get something to run correctly.</li>
          	<li>Formalise running scripts on remote machines, including support for running on multiple machines.</li>
          	<li>Paging for long lists of commands or runs.</li>
          </ul>
          <h2>Notes</h2>
          <p>I&#8217;m pretty happy with how it&#8217;s shaping up so far. Under the hood it works by having the web app put a <span class="caps">JSON</span> document on the message queue. The <span class="caps">JSON</span> contains the command to be run and a callback <span class="caps">URL</span>. The script listening to the message queue picks up the message, runs the command, and posts a <span class="caps">JSON</span> document back to the webhook url. It keeps the web interface snappy, as well as meaning it can show which commands are currently in progress at any given time. It also has the side benefit of meaning you can execute commands on a remote machine, as the listener doesn&#8217;t care where it&#8217;s running.</p>
          <p>As noted above I have a few ideas of where I want to take it, but I&#8217;m going to try using it for a bit and see how that goes. If anyone else finds it useful then do let me know.</p>
        </div>
      </div>
      <div id='other-articles'>
        <div class='older'>
          <ul>
            <li>
              <h3>
                <a href='/2009/07/13/its_data_we_want.html' title=''>
                  &laquo; It's the Data we Want
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2009/07/08/thoughts_whole_xhtml_and_html5_affair.html' title=''>
                  &laquo; Thoughts on the whole XHTML/HTML5 affair
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2009/07/01/pants_python_code.html' title=''>
                  &laquo; Pants Python Code
                </a>
              </h3>
            </li>
          </ul>
        </div>
        <div class='newer'>
          <ul>
            <li>
              <h3>
                <a href='/2009/07/23/whats_new_django_11.html' title=''>
                  What's new in Django 1.1 &raquo;
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2009/07/27/fabric_django_git_apache_mod_wsgi_virtualenv_and_p.html' title=''>
                  Fabric, Django, Git, Apache, mod_wsgi, virtualenv and pip deployment &raquo;
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2009/08/15/your_own_pypi_server.html' title=''>
                  Your Own PyPi server &raquo;
                </a>
              </h3>
            </li>
          </ul>
        </div>
      </div>
      <div class='clear'></div>
      <div class='clear'></div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      //]]>
    </script>
    <script type='text/javascript'>
      //<![CDATA[
        try {
          var pageTracker = _gat._getTracker("UA-435455-1");
          pageTracker._setDomainName(".morethanseven.net");
          pageTracker._setAllowHash(false);
          pageTracker._trackPageview();
        } catch(err) {}
      //]]>
    </script>
  </body>
</html>
