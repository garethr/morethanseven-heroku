<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <title>Generating Charts using Google Charts API</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type' />
    <meta content='' name='keywords' />
    <meta content='etkmKMftqAyYJM6-DP_TTKJjV0EHM5vbVcaOloSo8Z8' name='google-site-verification' />
    <link href='/assets/css/reset.css' rel='stylesheet' type='text/css' />
    <link href='/assets/css/style.css' media='screen' rel='stylesheet' type='text/css' />
    <link href='/assets/css/code.css' rel='stylesheet' type='text/css' />
    <link href='http://www.myopenid.com/server' rel='openid.server' />
    <link href='http://garethr.myopenid.com/' rel='openid.delegate' />
    <link href='/articles.atom' rel='alternate' title='Morethanseven Atom Feed' type='application/atom+xml' />
  </head>
  <body>
    <div id='main'>
      <div id='header'>
        <div class='logo'>
          <a href='/'>&laquo; morethanseven</a>
        </div>
        <div id='carbonads-container'>
          <div class='carbonad'>
            <div id='carbon'></div>
            <script type='text/javascript'>
              //<![CDATA[
                var z = document.createElement("script");
                z.type = "text/javascript";
                z.async = true;
                z.src = "http://engine.carbonads.com/z/12119/carbon_2_1_0_HORIZ";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(z, s);
              //]]>
            </script>
          </div>
        </div>
        <div id='nav'>
          <ul>
            <li><a href='/about.html'>about</a></li>
            <li><a href='/archives.html'>archives</a></li>
            <li><a href='/tags.html'>tags</a></li>
            <li>
              <a href='/articles.atom'>rss</a>
            </li>
          </ul>
        </div>
      </div>
      <div class='clear'></div>
      <div class='article'>
        <h1>
          Generating Charts using Google Charts API
        </h1>
        <div class='meta'>
          <ul class='tags'>
            <li>Mar 02, 2008</li>
            <li>
              &middot;
            </li>
            <li>
              <a href='/2008/03/02/generating-charts-using-google-charts-api.html#disqus_thread'></a>
            </li>
            <li>&middot;</li>
          </ul>
        </div>
        <div class='body'>
          <p>I had need recently to produce some nice looking charts and immediately turned to the very nice <a href="http://code.google.com/apis/chart/">Google Charts <span class="caps">API</span></a>. Just before Christmas <a href="http://suda.co.uk">Brian</a> had written up <a href="http://24ways.org/2007/tracking-christmas-cheer-with-google-charts">a great introduction</a> on <a href="http://24ways.org">24ways</a> and ever since I&#8217;d been looking for an excuse.</p>
          <p><a href="http://www.wait-till-i.com">Chris</a> wrote up a pretty nice approach to <a href="http://www.wait-till-i.com/2008/01/08/generating-charts-from-accessible-data-tables-using-the-google-charts-api/">enhancing well marked up data tables</a> using the Charts <span class="caps">API</span> with a dash of Javascript and I decided to start with that. I made only a couple of changes to this approach based on personal requirements and preferences.</p>
          <p>For a table like this:</p>
          <table class="tochart">
            <caption>Caption</caption>  
          <tr>
              <th scope="row">Label</th>
              <td>Data</td>
          </tr>
          <tr>
              <th scope="row">Label</th>
              <td>Data</td>
          </tr>
          </table>
          <p>I prefer to use the table header element to mark up the table row and the original script relied on these being <em>td</em> elements. A couple of changes to the javascript fixed that. I also decided to display the <em>caption</em> as a title on the resulting graph.</p>
          <pre><code>&#x000A;&lt;table class="tochart"&gt;&#x000A;  &lt;caption&gt;Caption&lt;/caption&gt;  &#x000A;  &lt;tr&gt;&#x000A;    &lt;th scope="row"&gt;Label&lt;/th&gt;&#x000A;    &lt;td&gt;Data&lt;/td&gt;&#x000A;  &lt;/tr&gt;&#x000A;  &lt;tr&gt;&#x000A;    &lt;th scope="row"&gt;Label&lt;/th&gt;&#x000A;    &lt;td&gt;Data&lt;/td&gt;&#x000A;  &lt;/tr&gt;&#x000A;&lt;/table&gt;&#x000A;</code></pre>
          <p>The original script only supported the 3D pie charts and in a couple of cases I wanted to generate bar-charts from the data or flat pie-charts. A few modifications later and you can pass a type parameter into the script via a class on the table.</p>
          <p>The default if the parameter isn&#8217;t set is the flat pie-chart, which can also be specified via:</p>
          <pre><code>&lt;table class="tochart typep"&gt;</code></pre>
          <p>For the 3D pie-chart:</p>
          <pre><code>&lt;table class="tochart typep3"&gt;</code></pre>
          <p>The horizontal bar-chart is created with:</p>
          <pre><code>&lt;table class="tochart typebhg"&gt;</code></pre>
          <p>And finally the vertical bar-chart is set based on:</p>
          <pre><code>&lt;table class="tochart typebvg"&gt;</code></pre>
          <p>The complete modified version of Chris&#8217; script is below:</p>
          <pre><code>(table2graph = function(){&#x000A;&#x000A;  /* variables */&#x000A;  var triggerClass = 'tochart';&#x000A;  var chartClass = 'fromtable';&#x000A;  var hideClass = 'hidden';&#x000A;  var chartColor = 'FFCC33';&#x000A;  var chartSize = '900x300';&#x000A;  var chartType = 'p';&#x000A;  &#x000A;  var toTableClass = 'totable';&#x000A;  var tableClass = 'generatedfromchart';&#x000A;  /* end variables */&#x000A;&#x000A;  var tables = document.getElementsByTagName('table');&#x000A;  var sizeCheck = /\s?size([^\s]+)/;&#x000A;  var colCheck = /\s?color([^\s]+)/;&#x000A;  var typeCheck = /\s?type([^\s]+)/;&#x000A;  for(var i=0;tables[i];i++){&#x000A;    var t = tables[i];&#x000A;    var c = t.className;&#x000A;    var data = [];&#x000A;    var labels = []&#x000A;    if(c.indexOf(triggerClass) !== -1){&#x000A;      var size = sizeCheck.exec(c);&#x000A;      size = size ? size[1] : chartSize;&#x000A;      var col = colCheck.exec(c);&#x000A;      col = col ? col[1] : chartColor;&#x000A;      var type = typeCheck.exec(c);&#x000A;      type = type ? type[1] : chartType;&#x000A;      &#x000A;      if (type == 'bhg') {&#x000A;        var label = 'chxl=1:|';&#x000A;      } else {&#x000A;       var label = 'chl=';&#x000A;      }&#x000A;      &#x000A;      var caption = t.getElementsByTagName('caption')[0].innerHTML;&#x000A;      var charturl = 'http://chart.apis.google.com/chart?cht=' + type + '&amp;chtt=' + caption + '&amp;chxt=x,y&amp;chco=' + col + '&amp;chs=' + size + '&amp;chd=t:';&#x000A;      t.className += ' '+ hideClass;&#x000A;      var ths = t.getElementsByTagName('tbody')[0].getElementsByTagName('th');&#x000A;      var tds = t.getElementsByTagName('tbody')[0].getElementsByTagName('td');&#x000A;      for(var j=0;tds[j];j+=1){&#x000A;        labels.push(ths[j].getElementsByTagName('em')[0].innerHTML.toLowerCase());&#x000A;        data.push(tds[j].innerHTML);&#x000A;      };&#x000A;      var chart = document.createElement('img');&#x000A;      chart.setAttribute('src',charturl+data.join(',') + '&amp;' + label + labels.join('|'));&#x000A;      chart.setAttribute('alt',t.getAttribute('summary'));&#x000A;      chart.className = chartClass;&#x000A;      t.parentNode.insertBefore(chart,t);&#x000A;    };&#x000A;  };&#x000A;  &#x000A;  /* convert charts to tables */&#x000A;  var charts = document.getElementsByTagName('img');&#x000A;  for(var i=0;charts[i];i++){&#x000A;    if(charts[i].className.indexOf(toTableClass) !== -1){&#x000A;      var t = document.createElement('table');&#x000A;      var tbody = document.createElement('tbody');&#x000A;      var data = charts[i].getAttribute('src');&#x000A;      var th,td,tr;&#x000A;      var values = data.match(/chd=t:([^&amp;]+)&amp;?/)[1];&#x000A;      var labels = data.match(/chl=([^&amp;]+)&amp;?/)[1];&#x000A;      var l = labels.split('|');&#x000A;      var v = values.split(',');&#x000A;      for(var j=0;l[j];j++){&#x000A;        tr = document.createElement('tr');&#x000A;        th = document.createElement('th');&#x000A;        th.appendChild(document.createTextNode(l[j]));&#x000A;        th.setAttribute('scope','row');&#x000A;        td = document.createElement('td');&#x000A;        td.appendChild(document.createTextNode(v[j]));&#x000A;        tr.appendChild(th);&#x000A;        tr.appendChild(td);&#x000A;        tbody.appendChild(tr);&#x000A;      };&#x000A;      t.appendChild(tbody);&#x000A;      t.setAttribute('summary',charts[i].getAttribute('alt'));&#x000A;      charts[i].parentNode.insertBefore(t,charts[i]);&#x000A;      charts[i].setAttribute('alt','');&#x000A;      t.className = tableClass;&#x000A;    };&#x000A;  };&#x000A;}());</code></pre>
        </div>
      </div>
      <div id='other-articles'>
        <div class='older'>
          <ul>
            <li>
              <h3>
                <a href='/2008/02/24/thinking-digital.html' title=''>
                  &laquo; Thinking Digital
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2008/02/21/sorry-but-the-flickr-api-isnt-rest.html' title=''>
                  &laquo; Sorry, but the Flickr API isn&#39;t REST
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2008/02/19/invited-to-join-wasp.html' title=''>
                  &laquo; Invited to Join WaSP
                </a>
              </h3>
            </li>
          </ul>
        </div>
        <div class='newer'>
          <ul>
            <li>
              <h3>
                <a href='/2008/03/14/accepted-for-xtech.html' title=''>
                  Accepted for Xtech &raquo;
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2008/03/19/own-your-endpoints.html' title=''>
                  Own your endpoints &raquo;
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2008/03/22/testing-websites-with-twill.html' title=''>
                  Testing Websites with Twill &raquo;
                </a>
              </h3>
            </li>
          </ul>
        </div>
      </div>
      <div class='clear'></div>
      <div class='comments'>
        <div id='disqus_thread'></div>
        <script src='http://disqus.com/forums/morethanseven/embed.js' type='text/javascript'></script>
        <noscript>
          <a href='http://disqus.com/forums/morethanseven/?url=ref'>
            View the discussion thread
          </a>
        </noscript>
      </div>
      <!-- / disqus adds too much visual crap -->
      <style type='text/css'>
        .dsq-dc-logo {
          display: none !important; }
      </style>
      <div class='clear'></div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        (function() {
          var links = document.getElementsByTagName('a');
          var query = '?';
          for(var i = 0; i < links.length; i++) {
            if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
            }
          }
          document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/morethanseven/get_num_replies.js' + query + '"></' + 'script>');
        })();
      //]]>
    </script>
    <script type='text/javascript'>
      //<![CDATA[
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      //]]>
    </script>
    <script type='text/javascript'>
      //<![CDATA[
        try {
          var pageTracker = _gat._getTracker("UA-435455-1");
          pageTracker._setDomainName(".morethanseven.net");
          pageTracker._setAllowHash(false);
          pageTracker._trackPageview();
          pageTracker._trackPageLoadTime();
        } catch(err) {}
      //]]>
    </script>
  </body>
</html>
