<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <title>Processing large files with sed and awk</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type' />
    <meta content='sed, awk' name='keywords' />
    <link href='/assets/css/reset.css' rel='stylesheet' type='text/css' />
    <link href='/assets/css/style.css' media='screen' rel='stylesheet' type='text/css' />
    <link href='/assets/css/code.css' rel='stylesheet' type='text/css' />
  </head>
  <body>
    <div id='main'>
      <div id='header'>
        <div class='logo'>
          <a href='/'>&laquo; morethanseven</a>
        </div>
        <div id='nav'>
          <ul>
            <li><a href='/about.html'>about</a></li>
            <li><a href='/archives.html'>archives</a></li>
            <li><a href='/tags.html'>tags</a></li>
            <li>
              <a href='/atom.xml'>rss</a>
            </li>
          </ul>
        </div>
      </div>
      <div class='clear'></div>
      <div class='article'>
        <h1>
          Processing large files with sed and awk
        </h1>
        <div class='meta'>
          <ul class='tags'>
            <li>Jan 26, 2010</li>
            <li>&middot;</li>
            <li>
              <a class='tag' href='/tags/awk/'>
                awk
              </a>
            </li>
            <li>
              <a class='tag' href='/tags/sed/'>
                sed
              </a>
            </li>
          </ul>
        </div>
        <div class='body'>
          <p>I found myself using a couple of powerful but underused command line applications this week and felt like sharing.</p>
          <p>My problem involved a large text file with over three million lines and a script that processed the file line by line, in this case running a <span class="caps">SQL</span> query against a remote database.</p>
          <p>My script didn&#8217;t try and process everything in one go, rather taking off large chunks and processing them in turn, then stopping and printing out the number of lines processed. This was mainly so I could keep an eye on it and make sure it wasn&#8217;t having a detrimental affect on other systems. But once I&#8217;d run the script once (and processed the first quarter of a million records or so) I wanted to run it again, except without the first batch of lines. For this I used sed. The following command creates a new file with the contents of the original file, minus the first 254263 lines.</p>
          <pre>sed '1,254263d' original.txt &gt; new.txt</pre>
          <p>I could then run my script with the input from new.txt and not have to reprocess the deleted lines. My next problem came when the network connection between the box running the script and the database dropped out. The script printed out the contents of the last line successfully processed, so what I wanted was a new file with the all contents of the old file past the last line. The following awk command does just that, assuming the last line processed was f251f9ee0b39beb5b5c4675ed4802113.</p>
          <pre>awk '/^f251f9ee0b39beb5b5c4675ed4802113/{f=1;next}f' original.txt &gt; new.txt</pre>
          <p>Now I could have made the script that did the work more complicated and ensure it dealt with these cases. But it would have involved much more code and the original scripts where only a handful of throw away code. For one off jobs like this a quick dive into the command line seemed more prudent.</p>
        </div>
      </div>
      <div id='other-articles'>
        <div class='older'>
          <ul>
            <li>
              <h3>
                <a href='/2010/01/07/speaking_dibi.html' title=''>
                  &laquo; Speaking at DIBI
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2009/11/28/dreque.html' title=''>
                  &laquo; Dreque
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2009/11/05/djugl_december.html' title=''>
                  &laquo; DJUGL December
                </a>
              </h3>
            </li>
          </ul>
        </div>
        <div class='newer'>
          <ul>
            <li>
              <h3>
                <a href='/2010/01/30/rabbitmq_support_cucumber_nagios.html' title=''>
                  RabbitMQ support for Cucumber-nagios &raquo;
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2010/02/01/rise_house_team.html' title=''>
                  The rise of the in-house team? &raquo;
                </a>
              </h3>
            </li>
            <li>
              <h3>
                <a href='/2010/02/11/djugl_february.html' title=''>
                  DJUGL February &raquo;
                </a>
              </h3>
            </li>
          </ul>
        </div>
      </div>
      <div class='clear'></div>
      <div class='clear'></div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      //]]>
    </script>
    <script type='text/javascript'>
      //<![CDATA[
        try {
          var pageTracker = _gat._getTracker("UA-435455-1");
          pageTracker._setDomainName(".morethanseven.net");
          pageTracker._setAllowHash(false);
          pageTracker._trackPageview();
        } catch(err) {}
      //]]>
    </script>
  </body>
</html>
